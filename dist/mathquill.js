(()=>{"use strict";
/* @license
 * MathQuill, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * Rewritten for the purposes of WeBWorK.
 * https://github.com/openwebwork
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
const t="data-mathquill-command-id",e="data-mathquill-block-id",s=-1,n=1,i=()=>{},r=t=>(e,s,n)=>t("function"==typeof e?e:t=>{if(e in t)return t[e](s,n)}),o=(t,...e)=>class extends t{constructor(...t){super(...e)}},l=(t,e=!1)=>{if(!e)throw new Error(`prayer failed: ${t}`)},a=t=>{l("a direction was passed",t===s||t===n)},c=(t,e,i)=>{l("a parent is always present",!!t),l("leftward is properly set up",e?e[n]===i&&e.parent===t:(null==t?void 0:t.ends[s])===i),l("rightward is properly set up",i?i[s]===e&&i.parent===t:(null==t?void 0:t.ends[n])===e)},d={},h={},u={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},p={},m={};for(const t of["arg","deg","det","dim","exp","gcd","hom","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"])m[t]=1;for(const t of["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"])m[t]=1;const f={limsup:1,liminf:1,projlim:1,injlim:1},v=(()=>{const t={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return(e,s)=>{let n=null,r=null;const o=e,l=s.container||o;let a,c=i;const d=t=>{c=t,clearTimeout(a),a=setTimeout(t)},h=t=>{d((e=>{c=i,clearTimeout(a),t(e)}))};for(const t of["keydown","keypress","input","keyup","focusout","paste"])l.addEventListener(t,(t=>c(t)));let u=!1;const p=()=>{var e;return null===(e=s.keystroke)||void 0===e?void 0:e.call(s,(e=>{const s=e.which||e.keyCode,n=t[s],i=[];e.ctrlKey&&i.push("Ctrl"),e.metaKey&&i.push("Meta"),e.altKey&&i.push("Alt"),e.shiftKey&&i.push("Shift");const r=n||String.fromCharCode(s);return i.length||n?(i.push(r),i.join("-")):r})(n),n)},m=()=>{if((()=>{const t=o;return"selectionStart"in t&&t.selectionStart!==t.selectionEnd})())return;const t=o.value;1===t.length?(o.value="",s.typedText(t)):t&&o.select&&o.select()};return l.addEventListener("keydown",(t=>{t.target===o&&(n=t,r=null,u&&h((t=>{t&&"focusout"===t.type||!o.select||o.select()})),p())})),l.addEventListener("keypress",(t=>{t.target===o&&(n&&r&&p(),r=t,d(m))})),l.addEventListener("keyup",(t=>{t.target===o&&n&&!r&&h(m)})),l.addEventListener("focusout",(()=>{n=r=null})),l.addEventListener("cut",(()=>h((()=>s.cut())))),l.addEventListener("copy",(()=>h((()=>s.copy())))),l.addEventListener("paste",(t=>{var e,n;if(t.target!==o)return;o.focus();const i=null!==(n=null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text"))&&void 0!==n?n:"";h((()=>{const t=o.value||i;o.value="",t&&s.paste(t)}))})),{select:t=>{c(),c=i,clearTimeout(a),o.value=t,t&&o.select&&o.select(),u=!!t}}}})();class g{constructor(){this.ignoreNextMousedown=()=>!1}static config(t,e){Object.assign(t,e)}get mouseEvents(){var t;return null!==(t=this._mouseEvents)&&void 0!==t?t:g.mouseEvents}set mouseEvents(t){this._mouseEvents=t}get autoCommands(){var t;return null!==(t=this._autoCommands)&&void 0!==t?t:g.autoCommands}set autoCommands(t){if("object"==typeof t)return void(this._autoCommands=t);if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw`"${t}" not a space-delimited list of only letters`;const e=t.split(" "),s={_maxLength:0};for(const t of e){if(t.length<2)throw`autocommand "${t}" not minimum length of 2`;if(t in m)throw`"${t}" is a built-in operator name`;s[t]=1,s._maxLength=Math.max(s._maxLength,t.length)}this._autoCommands=s}get autoOperatorNames(){var t;return null!==(t=this._autoOperatorNames)&&void 0!==t?t:g.autoOperatorNames}set autoOperatorNames(t){if("object"==typeof t)return void(this._autoCommands=t);if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw`"${t}" not a space-delimited list of only letters`;const e=t.split(" "),s={_maxLength:0};for(const t of e){if(t.length<2)throw`"${t}" not minimum length of 2`;s[t]=1,s._maxLength=Math.max(s._maxLength,t.length)}this._autoOperatorNames=s}get charsThatBreakOutOfSupSub(){var t;return null!==(t=this._charsThatBreakOutOfSupSub)&&void 0!==t?t:g.charsThatBreakOutOfSupSub}set charsThatBreakOutOfSupSub(t){this._charsThatBreakOutOfSupSub=t}get statelessClipboard(){var t;return null!==(t=this._statelessClipboard)&&void 0!==t?t:g.statelessClipboard}set statelessClipboard(t){this._statelessClipboard=t}get spaceBehavesLikeTab(){var t;return null!==(t=this._spaceBehavesLikeTab)&&void 0!==t?t:g.spaceBehavesLikeTab}set spaceBehavesLikeTab(t){this._spaceBehavesLikeTab=t}get leftRightIntoCmdGoes(){var t;return null!==(t=this._leftRightIntoCmdGoes)&&void 0!==t?t:g.leftRightIntoCmdGoes}set leftRightIntoCmdGoes(t){if(t&&"up"!==t&&"down"!==t)throw`"up" or "down" required for leftRightIntoCmdGoes option, got "${t}"`;this._leftRightIntoCmdGoes=t}get restrictMismatchedBrackets(){var t;return null!==(t=this._restrictMismatchedBrackes)&&void 0!==t?t:g.restrictMismatchedBrackets}set restrictMismatchedBrackets(t){this._restrictMismatchedBrackes=t}get sumStartsWithNEquals(){var t;return null!==(t=this._sumStartsWithNEquals)&&void 0!==t?t:g.sumStartsWithNEquals}set sumStartsWithNEquals(t){this._sumStartsWithNEquals=t}get supSubsRequireOperand(){var t;return null!==(t=this._supSubsRequireOperand)&&void 0!==t?t:g.supSubsRequireOperand}set supSubsRequireOperand(t){this._supSubsRequireOperand=t}get rootsAreExponents(){var t;return null!==(t=this._rootsAreExponents)&&void 0!==t?t:g.rootsAreExponents}set rootsAreExponents(t){this._rootsAreExponents=t}get maxDepth(){var t;return null!==(t=this._maxDepth)&&void 0!==t?t:g.maxDepth}set maxDepth(t){"number"==typeof t&&(this._maxDepth=t)}get autoSubscriptNumerals(){var t;return null!==(t=this._autoSubscriptNumerals)&&void 0!==t?t:g.autoSubscriptNumerals}set autoSubscriptNumerals(t){this._autoSubscriptNumerals=t}get typingSlashWritesDivisionSymbol(){var t;return null!==(t=this._typingSlashWritesDivisionSymbol)&&void 0!==t?t:g.typingSlashWritesDivisionSymbol}set typingSlashWritesDivisionSymbol(t){this._typingSlashWritesDivisionSymbol=t}get typingAsteriskWritesTimesSymbol(){var t;return null!==(t=this._typingAsteriskWritesTimesSymbol)&&void 0!==t?t:g.typingAsteriskWritesTimesSymbol}set typingAsteriskWritesTimesSymbol(t){this._typingAsteriskWritesTimesSymbol=t}substituteTextarea(){const t=document.createElement("textarea");return t.setAttribute("autocapitalize","off"),t.setAttribute("autocomplete","off"),t.setAttribute("autocorrext","off"),t.setAttribute("spellcheck","false"),t}substituteKeyboardEvents(t,e){return v(t,e)}}g.mouseEvents=!0,g.autoCommands={_maxLength:0},g.autoOperatorNames=(()=>{const t={_maxLength:9};for(const e of["arg","deg","det","dim","exp","gcd","hom","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"])t[e]=1;for(const e of["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"])t[e]=t[`arc${e}`]=t[`${e}h`]=t[`ar${e}h`]=t[`arc${e}h`]=1;for(const e of["gcf","hcf","lcm","proj","span"])t[e]=1;return t})(),g.charsThatBreakOutOfSupSub="",g.statelessClipboard=!1,g.spaceBehavesLikeTab=!1,g.leftRightIntoCmdGoes=void 0,g.restrictMismatchedBrackets=!1,g.sumStartsWithNEquals=!1,g.supSubsRequireOperand=!1,g.rootsAreExponents=!1,g.maxDepth=void 0,g.autoSubscriptNumerals=!1,g.typingSlashWritesDivisionSymbol=!1,g.typingAsteriskWritesTimesSymbol=!1;class b{constructor(t){if(this.contents=[],t instanceof b)this.contents.push(...t.contents);else if(t instanceof Node)this.contents.push(t);else if(t instanceof Array)this.contents.push(...t);else if(t){const e=document.createRange().createContextualFragment(t);this.contents.push(...e.children)}}add(t){this.contents.push(...t instanceof b?t.contents:t instanceof Array?t:[t]),this.contents.sort(((t,e)=>{if(t===e)return 0;const s=t.compareDocumentPosition(e);return s&Node.DOCUMENT_POSITION_FOLLOWING||s&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:s&Node.DOCUMENT_POSITION_PRECEDING||s&Node.DOCUMENT_POSITION_CONTAINS?1:0}))}get first(){return this.contents[0]instanceof Element||this.contents[0]instanceof CharacterData?this.contents[0]:document.createElement("span")}get last(){const t=this.contents[this.contents.length-1];return t instanceof Element||t instanceof CharacterData?t:document.createElement("span")}get firstElement(){return this.first instanceof HTMLElement?this.first:document.createElement("span")}get lastElement(){return this.last instanceof HTMLElement?this.last:document.createElement("span")}detach(){this.contents.forEach((t=>t.remove()))}remove(){this.detach(),this.contents=[]}empty(){this.contents.forEach((t=>{for(;t.firstChild;)t.firstChild.remove();t.textContent=""}))}children(t){return new b(this.contents.reduce(((e,s)=>(e.push(...Array.from(s.childNodes).filter((e=>3!==e.nodeType&&(!t||e instanceof Element&&e.matches(t))))),e)),[]))}find(t){return new b(this.contents.reduce(((e,s)=>(e.push(...s.querySelectorAll(t)),e)),[]))}addClass(...t){this.contents.forEach((e=>{e instanceof Element&&e.classList.add(...t)}))}removeClass(...t){this.contents.forEach((e=>{e instanceof Element&&e.classList.remove(...t)}))}toggleClass(t,e){this.contents.forEach((s=>{s instanceof Element&&s.classList.toggle(t,e)}))}hasClass(t){for(const e of this.contents)if(e instanceof Element&&e.classList.contains(t))return!0;return!1}html(t){var e,s;return"string"==typeof t?(this.contents.forEach((e=>{e instanceof Element&&(e.innerHTML=t)})),this):null!==(s=null===(e=this.firstElement)||void 0===e?void 0:e.innerHTML)&&void 0!==s?s:""}text(t){return t?(this.contents.forEach((e=>{e instanceof Element&&(e.textContent=t)})),this):this.contents.reduce(((t,e)=>{var s;return`${t}${null!==(s=e.textContent)&&void 0!==s?s:""}`}),"")}insDirOf(t,e){e instanceof b&&!e.contents.length||(t===s?(e instanceof b?e.first:e).before(...this.contents):(e instanceof b?e.last:e).after(...this.contents))}insAtDirEnd(t,e){e instanceof b&&!e.contents.length||(t===s?(e instanceof b?e.firstElement:e).prepend(...this.contents):(e instanceof b?e.lastElement:e).append(...this.contents))}}class x{constructor(t,e,i=s){if(this.elements=new b,this.ends={},this.each=r((t=>{var e;let i=this.ends[s];if(!i)return this;for(;i!==(null===(e=this.ends[n])||void 0===e?void 0:e[n])&&!1!==t(i);i=null==i?void 0:i[n]);return this})),l("no half-empty fragments",!t==!e),!t)return;l("withDir is passed to Fragment",t instanceof E),l("oppDir is passed to Fragment",e instanceof E),l("withDir and oppDir have the same parent",t.parent===(null==e?void 0:e.parent)),this.ends[i]=t,this.ends[i===s?n:s]=e;const o=this.fold([],((t,e)=>(t.push(...e.elements.contents),t)));this.elements.add(o)}withDirAdopt(t,e,n,i){return t===s?this.adopt(e,n,i):this.adopt(e,i,n)}adopt(t,e,i){c(t,e,i),this.disowned=!1;const r=this.ends[s];if(!r)return this;const o=this.ends[n];return e||(t.ends[s]=r),i?i[s]=o:t.ends[n]=o,this.ends[n][n]=i,this.each((i=>{i[s]=e,i.parent=t,e&&(e[n]=i),e=i})),this}disown(){const t=this.ends[s];if(!t||this.disowned)return this;this.disowned=!0;const e=this.ends[n],i=t.parent;return c(i,t[s],t),c(i,e,null==e?void 0:e[n]),t[s]?t[s][n]=null==e?void 0:e[n]:i.ends[s]=null==e?void 0:e[n],(null==e?void 0:e[n])?e[n][s]=t[s]:i.ends[n]=t[s],this}remove(){return this.elements.remove(),this.each("postOrder","dispose"),this.disown()}fold(t,e){let s=t;return this.each((t=>{s=e(s,t)})),s}}class w extends x{constructor(t,e,n=s){super(t,e,n);const i=document.createElement("span");i.classList.add("mq-selection"),this.elements.first.before(i),i.append(...this.elements.contents),this.elements=new b(i)}adopt(t,e,s){const n=this.elements.children();return this.elements.first.replaceWith(...n.contents),this.elements=n,super.adopt(t,e,s)}clear(){return this.elements.first.replaceWith(...this.elements.first.childNodes),this}join(t){return this.fold("",((e,s)=>e+s[t]()))}}const q=t=>l(`"${t}" should be overridden or never called on this node`);class E{constructor(){this.elements=new b,this.ends={},this.ctrlSeq="",this.bubble=r((t=>{for(let e=this;e&&!1!==t(e);e=e.parent);return this})),this.postOrder=r((t=>(function e(s){s.eachChild(e),t(s)}(this),this))),this.id=E.uniqueNodeId(),E.byId[this.id]=this}dispose(){delete E.byId[this.id]}toString(){return`{{ MathQuill TNode #${this.id} }}`}addToElements(t){this.elements.add(t)}domify(s){const n=s instanceof b?s:new b(this.html()),i=s=>{var n,r;if(s instanceof HTMLElement){const i=parseInt(null!==(n=s.getAttribute(t))&&void 0!==n?n:"0"),o=parseInt(null!==(r=s.getAttribute(e))&&void 0!==r?r:"0");i&&E.byId[i].addToElements(s),o&&E.byId[o].addToElements(s)}for(let t=s.firstChild;t;t=t.nextSibling)i(t)};return n.contents.forEach((t=>i(t))),n}createDir(t,e){return a(t),this.domify(),this.elements.insDirOf(t,e.element),e[t]=this.adopt(e.parent,e[s],e[n]),this}createLeftOf(t){this.createDir(s,t)}selectChildren(t,e){return new w(t,e)}isEmpty(){return!this.ends[s]&&!this.ends[n]}isStyleBlock(){return!1}children(){return new x(this.ends[s],this.ends[n])}eachChild(t,e){return this.children().each(t,e),this}foldChildren(t,e){return this.children().fold(t,e)}withDirAdopt(t,e,s,n){return new x(this,this).withDirAdopt(t,e,s,n),this}adopt(t,e,s){return new x(this,this).adopt(t,e,s),this}disown(){return new x(this,this).disown(),this}remove(){return this.elements.remove(),this.postOrder("dispose"),this.disown()}keystroke(t,e,i){const r=i.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":i.ctrlDeleteDir(s);break;case"Shift-Backspace":case"Backspace":i.backspace();break;case"Esc":case"Tab":return void i.escapeDir(n,t,e);case"Shift-Tab":case"Shift-Esc":return void i.escapeDir(s,t,e);case"End":i.notify("move").cursor.insAtRightEnd(r.parent);break;case"Ctrl-End":i.notify("move").cursor.insAtRightEnd(i.root);break;case"Shift-End":for(;r[n];)i.selectRight();break;case"Ctrl-Shift-End":for(;r[n]||r.parent!==i.root;)i.selectRight();break;case"Home":i.notify("move").cursor.insAtLeftEnd(r.parent);break;case"Ctrl-Home":i.notify("move").cursor.insAtLeftEnd(i.root);break;case"Shift-Home":for(;r[s];)i.selectLeft();break;case"Ctrl-Shift-Home":for(;r[s]||r.parent!==i.root;)i.selectLeft();break;case"Left":i.moveLeft();break;case"Shift-Left":i.selectLeft();break;case"Ctrl-Left":case"Ctrl-Right":case"Ctrl-Up":case"Ctrl-Down":break;case"Right":i.moveRight();break;case"Shift-Right":i.selectRight();break;case"Up":i.moveUp();break;case"Down":i.moveDown();break;case"Shift-Up":if(r[s])for(;r[s];)i.selectLeft();else i.selectLeft();break;case"Shift-Down":if(r[n])for(;r[n];)i.selectRight();else i.selectRight();break;case"Ctrl-Shift-Del":case"Ctrl-Del":i.ctrlDeleteDir(n);break;case"Shift-Del":case"Del":i.deleteForward();break;case"Meta-A":case"Ctrl-A":for(i.notify("move").cursor.insAtRightEnd(i.root);r[s];)i.selectLeft();break;default:return}e.preventDefault(),i.scrollHoriz()}html(){return""}text(){return""}latex(){return""}focus(){}blur(t){}seek(t,e){}writeLatex(t,e){}finalizeInsert(t,e){}write(t,e){}replaces(t){}setOptions(t){return this}chToCmd(t,e){return this}moveOutOf(t,e,s){q("moveOutOf")}moveTowards(t,e,s){q("moveTowards")}deleteOutOf(t,e){q("deleteOutOf")}deleteTowards(t,e){q("deleteTowards")}unselectInto(t,e){q("unselectInto")}selectOutOf(t,e){q("selectOutOf")}selectTowards(t,e){q("selectTowards")}}E.id=0,E.byId={},E.uniqueNodeId=()=>++E.id;class O{constructor(t,e,i){this.parent=t,this[s]=e,this[n]=i}static copy(t){return new O(t.parent,t[s],t[n])}}const y=t=>{t.moveOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("moveOutOf",e)},t.deleteOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("deleteOutOf",e)},t.selectOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("selectOutOf",e)},t.upOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("upOutOf",e)},t.downOutOf=e=>{var s;return null===(s=t.controller)||void 0===s?void 0:s.handle("downOutOf",e)},t.reflow=()=>{var e,s,n;null===(e=t.controller)||void 0===e||e.handle("reflow"),null===(s=t.controller)||void 0===s||s.handle("edited"),null===(n=t.controller)||void 0===n||n.handle("edit")}},S=t=>class extends t{moveTowards(t,e,i){const r=i&&this[`${i}Into`];e.insAtDirEnd(t===s?n:s,r||this.ends[t===s?n:s])}deleteTowards(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e)}selectTowards(t,e){e[t===s?n:s]=this,e[t]=this[t]}},_=(t,e,s)=>t.forEach((t=>t.style.transform=`scale(${e},${s})`)),k=t=>class extends t{constructor(){super(...arguments),this.reflow=()=>{var t,e,s;const n=this.content?getComputedStyle(this.content):void 0,i=null===(t=this.content)||void 0===t?void 0:t.getBoundingClientRect(),r=(null!==(e=null==i?void 0:i.height)&&void 0!==e?e:0)/parseFloat(null!==(s=null==n?void 0:n.fontSize)&&void 0!==s?s:"1");_(this.delims,Math.min(1+.2*(r-1),1.2),1.2*r)}}addToElements(t){super.addToElements(t);const e=this.elements.children();this.delims=[e.firstElement,e.lastElement],this.content=e.contents[1]}};class C{constructor(t){this._=t}parse(t){return this.skip(C.eof)._(`${t}`,((t,e)=>e),((t,e)=>{throw`Parse Error: ${e} at ${t||"EOF"}`}))}or(t){return l("or is passed a parser",t instanceof C),new C(((e,s,n)=>this._(e,s,(()=>t._(e,s,n)))))}then(t){return new C(((e,s,n)=>this._(e,((e,i)=>{const r=t instanceof C?t:"function"==typeof t?t(i):void 0;return l("a parser is returned",r instanceof C),r._(e,s,n)}),n)))}many(){return new C(((t,e)=>{const s=[];for(;this._(t,((e,n)=>(t=e,s.push(n),!0)),(()=>!1)););return e(t,s)}))}times(t,e=t){return new C(((s,n,i)=>{const r=[];let o=!0;for(let n=0;n<e&&o;++n){let e;if(o=this._(s,((t,e)=>(r.push(e),s=t,!0)),((t,n)=>(e=n,s=t,!1))),n<t&&!o)return i(s,e)}return n(s,r)}))}result(t){return this.then(C.succeed(t))}atMost(t){return this.times(0,t)}atLeast(t){return this.times(t).then((t=>this.many().map((e=>t.concat(e)))))}map(t){return this.then((e=>"function"==typeof t&&/^\s*class\s+/.test(t.toString())?C.succeed(new t(e)):"function"==typeof t?C.succeed(t(e)):C.fail("Invalid map function")))}skip(t){return this.then((e=>t.result(e)))}static string(t){return new C(((e,s,n)=>{const i=e.slice(0,t.length);return i===t?s(e.slice(t.length),i):n(e,`expected '${t}'`)}))}static regex(t){return l("regexp parser is anchored","^"===t.toString().charAt(1)),new C(((e,s,n)=>{const i=t.exec(e);return i?s(e.slice(i[0].length),i[0]):n(e,`expected ${t.toString()}`)}))}static succeed(t){return new C(((e,s)=>s(e,t)))}static fail(t){return new C(((e,s,n)=>n(e,t)))}}C.letter=C.regex(/^[a-z]/i),C.letters=C.regex(/^[a-z]*/i),C.digit=C.regex(/^[0-9]/),C.digits=C.regex(/^[0-9]*/),C.whitespace=C.regex(/^\s+/),C.optWhitespace=C.regex(/^\s*/),C.any=new C(((t,e,s)=>t?e(t.slice(1),t.charAt(0)):s(t,"expected any character"))),C.all=new C(((t,e)=>e("",t))),C.eof=new C(((t,e,s)=>t?s(t,"expected EOF"):e(t,t)));const T=t=>class extends t{focusBlurEvents(){var t,e,s;this.focusHandler=()=>{var t;this.blurred=!1,this.container.classList.add("mq-focused"),this.cursor.parent||this.cursor.insAtRightEnd(this.root),this.cursor.selection?(this.cursor.selection.elements.removeClass("mq-blur"),null===(t=this.selectionChanged)||void 0===t||t.call(this)):this.cursor.show()},null===(t=this.textarea)||void 0===t||t.addEventListener("focus",this.focusHandler),this.blurHandler=()=>{var t;this.blurred=!0,this.container.classList.remove("mq-focused"),null===(t=this.cursor.hide().parent)||void 0===t||t.blur(),this.cursor.selection&&this.cursor.selection.elements.addClass("mq-blur")},null===(e=this.textarea)||void 0===e||e.addEventListener("blur",this.blurHandler),this.blurred=!0,null===(s=this.cursor.hide().parent)||void 0===s||s.blur()}unbindFocusBlurEvents(){var t,e;this.focusHandler&&(null===(t=this.textarea)||void 0===t||t.removeEventListener("focus",this.focusHandler)),this.blurHandler&&(null===(e=this.textarea)||void 0===e||e.removeEventListener("blur",this.blurHandler)),delete this.focusHandler,delete this.blurHandler}},L=t=>class extends t{focus(){this.elements.addClass("mq-has-cursor"),this.elements.removeClass("mq-empty")}blur(){this.elements.removeClass("mq-has-cursor"),this.isEmpty()&&this.elements.addClass("mq-empty")}};class D extends E{finalizeInsert(t,e){var i,r,o,l;this.postOrder("finalizeTree",t),this.postOrder("contactWeld",e),this.postOrder("blur"),this.postOrder("reflow"),null===(r=null===(i=this[n])||void 0===i?void 0:i.siblingCreated)||void 0===r||r.call(i,t,s),null===(l=null===(o=this[s])||void 0===o?void 0:o.siblingCreated)||void 0===l||l.call(o,t,n),this.bubble("reflow")}prepareInsertionAt(t){const e=t.options.maxDepth;if(void 0!==e){const s=t.depth();if(s>e)return!1;this.removeNodesDeeperThan(e-s)}return!0}removeNodesDeeperThan(t){var e;let s=0;const n=[[this,s]];for(;n.length;){const i=n.shift();null===(e=null==i?void 0:i[0].children())||void 0===e||e.each((e=>{const r=e instanceof G?1:0;s=i[1]+r,s<=t?n.push([e,s]):(r?e.children():e).remove()}))}}}class $ extends(S(D)){constructor(t,e,s){super(),this.blocks=[],this.ctrlSeq=null!=t?t:"",this.htmlTemplate=null!=e?e:"",this.textTemplate=null!=s?s:[""]}replaces(t){null==t||t.disown(),this.replacedFragment=t}isEmpty(){return this.foldChildren(!0,((t,e)=>t&&e.isEmpty()))}parser(){return V.block.times(this.numBlocks()).map((t=>{this.blocks=t;for(const e of t)e.adopt(this,this.ends[n]);return this}))}createLeftOf(t){var e;const n=this.replacedFragment;this.createBlocks(),super.createLeftOf(t),n&&(n.adopt(this.ends[s]),null===(e=this.ends[s])||void 0===e||e.elements.firstElement.append(...n.elements.contents),this.placeCursor(t),this.prepareInsertionAt(t)),this.finalizeInsert(t.options),this.placeCursor(t)}createBlocks(){const t=this.numBlocks();this.blocks=Array(t);for(let e=0;e<t;++e)this.blocks[e]=new G,this.blocks[e].adopt(this,this.ends[n])}placeCursor(t){t.insAtRightEnd(this.foldChildren(this.ends[s],((t,e)=>t.isEmpty()?t:e)))}selectChildren(){return new w(this,this)}unselectInto(t,e){var i,r;e.insAtDirEnd(t===s?n:s,null===(r=null===(i=e.anticursor)||void 0===i?void 0:i.ancestors)||void 0===r?void 0:r[this.id])}seek(t,e){const i=t=>{const e=t.elements.firstElement.getBoundingClientRect();return{[s]:e.left,[n]:e.left+e.width}},r=i(this);if(t<r[s])return void e.insLeftOf(this);if(t>r[n])return void e.insRightOf(this);let o=r[s];this.eachChild((l=>{const a=i(l);return t<a[s]?(t-o<a[s]-t?l[s]?e.insAtRightEnd(l[s]):e.insLeftOf(this):e.insAtLeftEnd(l),!1):t>a[n]?void(l[n]?o=a[n]:r[n]-t<t-a[n]?e.insRightOf(this):e.insAtRightEnd(l)):(l.seek(t,e),!1)}))}numBlocks(){const t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0}html(){const s=this.blocks,n=` ${t}=${this.id}`,i=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);l("no unmatched angle brackets",i.join("")===this.htmlTemplate);for(let t=0,e=i[0];e;++t,e=i[t])if("/>"===e.slice(-2))i[t]=`${e.slice(0,-2)}${n}/>`;else if("<"===e.charAt(0)){l("not an unmatched top-level close tag","/"!==e.charAt(1)),i[t]=`${e.slice(0,-1)}${n}>`;let s=1;do{t+=1,e=i[t],l("no missing close tags",!!e),"</"===e.slice(0,2)?s-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(s+=1)}while(s>0)}return i.join("").replace(/>&(\d+)/g,((t,n)=>{var i,r,o,l;return` ${e}=${null!==(r=null===(i=s[n])||void 0===i?void 0:i.id)&&void 0!==r?r:""}>${null!==(l=null===(o=s[n])||void 0===o?void 0:o.join("html"))&&void 0!==l?l:""}`}))}latex(){return this.foldChildren(this.ctrlSeq,((t,e)=>`${t}{${e.latex()||" "}}`))}text(){let t=0;return this.foldChildren(this.textTemplate[t],((e,s)=>{++t;const n=s.text();return e&&"("===this.textTemplate[t]&&"("===n[0]&&")"===n.slice(-1)?e+n.slice(1,-1)+this.textTemplate[t]:e+n+(this.textTemplate[t]||"")}))}}class A extends ${constructor(t,e,s){const n=s||(t&&t.length>1?t.slice(1):null!=t?t:"");super(t,e,[n]),this.createBlocks=i,this.isSymbol=!0}parser(){return C.succeed(this)}numBlocks(){return 0}replaces(t){null==t||t.remove()}moveTowards(t,e){t===s?this.elements.first.before(e.element):this.elements.last.after(e.element),e[t===s?n:s]=this,e[t]=this[t]}deleteTowards(t,e){e[t]=this.remove()[t]}seek(t,e){const s=this.elements.firstElement.getBoundingClientRect();t-s.left<s.width/2?e.insLeftOf(this):e.insRightOf(this)}latex(){return this.ctrlSeq}text(){return this.textTemplate.join("")}placeCursor(){}isEmpty(){return!0}}class R extends A{constructor(t,e,s){super(t,`<span>${e||t}</span>`,s)}}class I extends A{constructor(t,e,s,n=!1){super(t,!0===n?e:`<span class="mq-binary-operator">${null!=e?e:""}</span>`,s),this.isUnary=!1}}class B extends I{constructor(t,e){const s=e?"Strict":"";super(t[`ctrlSeq${s}`],t[`html${s}`],t[`text${s}`]),this.data=t,this.strict=e}swap(t){this.strict=t;const e=t?"Strict":"";this.ctrlSeq=this.data[`ctrlSeq${e}`],this.elements.html(this.data[`html${e}`]),this.textTemplate=[this.data[`text${e}`]]}deleteTowards(t,e){if(t===s&&!this.strict)return this.swap(!0),void this.bubble("reflow");super.deleteTowards(t,e)}}class N extends I{constructor(){super("=","=")}createLeftOf(t){var e;if(t[s]instanceof B&&t[s].strict)return t[s].swap(!1),void(null===(e=t[s])||void 0===e||e.bubble("reflow"));super.createLeftOf(t)}}class z extends R{createLeftOf(t){var e,n,i,r,o;t.options.autoSubscriptNumerals&&t.parent!==(null===(n=null===(e=t.parent)||void 0===e?void 0:e.parent)||void 0===n?void 0:n.sub)&&(t[s]instanceof M&&!1!==t[s].isItalic||t[s]instanceof H&&(null===(i=t[s])||void 0===i?void 0:i[s])instanceof M&&!1!==(null===(r=t[s])||void 0===r?void 0:r[s].isItalic))?((new d._).createLeftOf(t),super.createLeftOf(t),t.insRightOf(null===(o=t.parent)||void 0===o?void 0:o.parent)):super.createLeftOf(t)}}class M extends A{constructor(t,e){super(t,`<var>${e||t}</var>`),this.isItalic=!1}text(){let t=this.ctrlSeq;return"\\"==t[0]?t=t.startsWith("\\operatorname{")?t.slice(14,t.length):t.slice(1,t.length):" "!=t[t.length-1]&&"}"!=t[t.length-1]||(t=t.slice(0,-1),this[n]instanceof j||this[n]instanceof P||this[n]instanceof H||(t+=" ")),t}}class F extends M{constructor(t,e){super(t,e),this.letter=t,this.siblingDeleted=this.siblingCreated=(t,e)=>this.finalizeTree(t,e)}createLeftOf(t){super.createLeftOf(t);const e=t.options.autoCommands,n=e._maxLength;if(n>0){let i="",r=this,o=0;for(;r instanceof F&&(null==r?void 0:r.ctrlSeq)===(null==r?void 0:r.letter)&&o<n;)i=r.letter+i,r=r[s],++o;for(;i.length;){if(e[i]){for(o=1,r=this;o<i.length;++o,r=null==r?void 0:r[s]);return new x(r,this).remove(),t[s]=null==r?void 0:r[s],new d[i](i).createLeftOf(t)}i=i.slice(1)}}}italicize(t){return this.isItalic=t,this.elements.toggleClass("mq-operator-name",!t),this}finalizeTree(t,e){e!==s&&this[n]instanceof F||this.autoUnItalicize(t)}autoUnItalicize(t){var e,i,r,o,l,a,c;const d=t.autoOperatorNames;if(0===d._maxLength)return;let h=this.letter,u=this[s],p=this[n];for(;u instanceof F;u=u[s])h=u.letter+h;for(;p instanceof F;p=p[n])h+=p.letter;new x((null==u?void 0:u[n])||(null===(e=this.parent)||void 0===e?void 0:e.ends[s]),(null==p?void 0:p[s])||(null===(i=this.parent)||void 0===i?void 0:i.ends[n])).each((t=>{t.italicize(!0).elements.removeClass("mq-first","mq-last","mq-followed-by-supsub"),t.ctrlSeq=t.letter}));for(let e=0,i=(null==u?void 0:u[n])||(null===(r=this.parent)||void 0===r?void 0:r.ends[s]);e<h.length;++e,i=null==i?void 0:i[n])for(let r=Math.min(d._maxLength,h.length-e);r>0;--r){const u=h.slice(e,e+r);if(d[u]){let d;for(let t=0,e=i;t<r;t+=1,e=null==e?void 0:e[n])e.italicize(!1),d=e;const h=m[u];if(i.ctrlSeq=(h?"\\":"\\operatorname{")+(null!==(o=null==i?void 0:i.ctrlSeq)&&void 0!==o?o:""),d.ctrlSeq+=h?" ":"}",u in f&&(null===(c=null===(a=null===(l=null==d?void 0:d[s])||void 0===l?void 0:l[s])||void 0===a?void 0:a[s])||void 0===c||c.elements.addClass("mq-last")),this.shouldOmitPadding(null==i?void 0:i[s])||null==i||i.elements.addClass("mq-first"),!this.shouldOmitPadding(null==d?void 0:d[n]))if((null==d?void 0:d[n])instanceof H){const e=d[n];e.siblingCreated=e.siblingDeleted=()=>{e.elements.toggleClass("mq-after-operator-name",!(e[n]instanceof j))},e.siblingCreated(t)}else null==d||d.elements.toggleClass("mq-last",!((null==d?void 0:d[n])instanceof j));e+=r-1,i=d;break}}}shouldOmitPadding(t){return!t||t instanceof I||t instanceof U}}function W(t){var e;const s=this.parent;let i=t;do{if(null==i?void 0:i[n])return t.insLeftOf(s);i=null===(e=null==i?void 0:i.parent)||void 0===e?void 0:e.parent}while(i!==s);t.insRightOf(s)}class P extends ${constructor(){super(),this.ctrlSeq="\\frac",this.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',this.textTemplate=["((",")/(","))"]}text(){var t;let e=this[s];for(;e&&"\\ "===e.ctrlSeq;e=e[s]);const i=t=>{var e,n,i;let r=!1,o=0,l=!1;null===(e=this.ends[t])||void 0===e||e.eachChild((t=>(t instanceof z&&(l=!0),t instanceof z||t instanceof I&&t.isUnary||t instanceof H||++o,(l&&o||o>1||t instanceof I&&!t.isUnary||"text"in d&&t instanceof d.text||t instanceof U||t instanceof P||"\\ "===t.ctrlSeq||/^[,;:]$/.test(t.ctrlSeq))&&(r=!0),!r)));const a=t===s?0:1,c=" "!==(null===(n=this.ends[t])||void 0===n?void 0:n.text())&&(null===(i=this.ends[t])||void 0===i?void 0:i.text());return c?r?`(${c})`:c:a};return e instanceof I&&e.isUnary||(null==e?void 0:e.elements.hasClass("mq-operator-name"))||e instanceof H&&(null===(t=e[s])||void 0===t?void 0:t.elements.hasClass("mq-operator-name"))?`(${i(s)}/${i(n)})`:` ${i(s)}/${i(n)} `}finalizeTree(){this.upInto=this.ends[n].upOutOf=this.ends[s],this.downInto=this.ends[s].downOutOf=this.ends[n]}}class H extends ${constructor(t,e,s){super("_{...}^{...}",e,s),this.supsub="sup",this.reflow=()=>{const t=this.elements,e=t.first.previousElementSibling;if(!e)return;const s=t.children(".mq-sup").firstElement;if(s){const t=getComputedStyle(s),n=s.getBoundingClientRect(),i=parseInt(t.fontSize),r=n.top+n.height-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-e.getBoundingClientRect().top-.7*i,o=parseInt(t.marginBottom);s.style.marginBottom=`${o+r}px`}}}hasValidBase(t){var e,n,i;return!(t.options.supSubsRequireOperand&&(!t[s]||"\\ "===(null===(e=t[s])||void 0===e?void 0:e.ctrlSeq)||t[s]instanceof I||/^[,;:]$/.test(null!==(i=null===(n=t[s])||void 0===n?void 0:n.ctrlSeq)&&void 0!==i?i:"")))}createLeftOf(t){if(this.hasValidBase(t)){if(t[s]instanceof P){const e=new j(n,"(",")","(",")");t.selection=t[s].selectChildren(),e.replaces(t.replaceSelection()),e.createLeftOf(t)}super.createLeftOf(t)}else this.replacedFragment&&(this.replacedFragment.adopt(t.parent,t[s],t[n]),t[s]=this.replacedFragment.ends[n])}contactWeld(t){var e,i;for(const e of[s,n])if(this[e]instanceof H){let i;for(const t of["sub","sup"]){const r=this[t],o=this[e][t];if(r){if(o)if(r.isEmpty())i=new O(o,void 0,o.ends[s]);else{r.elements.children().insAtDirEnd(e===s?n:s,o.elements);const t=r.children().disown();i=new O(o,t.ends[n],o.ends[s]),e===s?t.adopt(o,o.ends[n]):t.adopt(o,void 0,o.ends[s])}else this[e].addBlock(r.disown());this.placeCursor=t=>t.insAtDirEnd(e===s?n:s,o||r)}}return this.remove(),void(t&&(t[s]===this?e===n&&i?i[s]?t.insRightOf(i[s]):t.insAtLeftEnd(i.parent):t.insRightOf(this[e]):(null==i?void 0:i[n])&&t.insRightOf(i[n])))}if(t&&t[n]===this&&(!this.hasValidBase(t)||t[s]instanceof P)){for(const r of["sub","sup"]){const o=this[r];o&&(o.children().disown().adopt(t.parent,t[s],t[n]).elements.insDirOf(n,t.element),(null===(e=t[s])||void 0===e?void 0:e[n])?t.insLeftOf(null===(i=t[s])||void 0===i?void 0:i[n]):t.insAtDirEnd(s,t.parent))}this.remove()}}finalizeTree(){this.ends[s].isSupSubLeft=!0}moveTowards(t,e,s){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):super.moveTowards(t,e,s)}deleteTowards(t,e){if(e.options.autoSubscriptNumerals&&this.sub){const i=this.sub.ends[t===s?n:s];i instanceof A?i.remove():i&&i.deleteTowards(t,e.insAtDirEnd(t===s?n:s,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(s,e.insAtLeftEnd(this.sub)),this.sup&&e.insDirOf(t===s?n:s,this))}else super.deleteTowards(t,e)}latex(){const t=(t,e)=>{const s=e&&e.latex();return e?t+(1===(null==s?void 0:s.length)?s:`{${s||" "}}`):""};return t("_",this.sub)+t("^",this.sup)}text(){const t=(t,e)=>{let s=!1,n=0,i=!1;null==e||e.eachChild((t=>(t instanceof z&&(i=!0),t instanceof z||t instanceof I&&t.isUnary||++n,(i&&n||n>1||t instanceof I&&!t.isUnary||"text"in d&&t instanceof d.text||t instanceof U||t instanceof P||"\\ "===t.ctrlSeq||/^[,;:]$/.test(t.ctrlSeq))&&(s=!0),!s)));const r=" "!==(null==e?void 0:e.text())&&(null==e?void 0:e.text());return r?t+(s?`(${r})`:r):""},e=t("_",this.sub)+t("^",this.sup);return e+(e&&this[n]instanceof z?" ":"")}addBlock(t){if("sub"===this.supsub){this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub).downOutOf=this.sub;const s=document.createElement("span");s.classList.add("mq-sup"),s.append(...t.elements.children().contents),s.setAttribute(e,t.id.toString()),this.elements.firstElement.prepend(s),t.elements=new b(s)}else{this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,void 0,this.sup).upOutOf=this.sup;const s=document.createElement("span");s.classList.add("mq-sub"),s.append(...t.elements.children().contents),s.setAttribute(e,t.id.toString()),this.elements.removeClass("mq-sup-only"),this.elements.firstElement.append(s),t.elements=new b(s);const n=document.createElement("span");n.style.display="inline-block",n.style.width="0",n.textContent="​",this.elements.firstElement.append(n)}for(const t of["sub","sup"]){const e="sub"===t?"sup":"sub",i="sub"===t?"down":"up",r=this[t];r.deleteOutOf=(o,l)=>{var a;if(l.insDirOf(r[o]?o===s?n:s:o,r.parent),!r.isEmpty()){const t=r.ends[o];r.children().disown().withDirAdopt(o,l.parent,l[o],l[o===s?n:s]).elements.insDirOf(o===s?n:s,l.element),l[o===s?n:s]=t}this.supsub=e,delete this[t],delete this[`${i}Into`],this[e][`${i}OutOf`]=W,delete this[e].deleteOutOf,"sub"===t&&(this.elements.addClass("mq-sup-only"),null===(a=this.elements.first.lastChild)||void 0===a||a.remove()),r.remove()}}}}class U extends ${latex(){var t,e,i,r;const o=t=>1===t.length?t:`{${t||" "}}`;return`${this.ctrlSeq}_${o(null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:"")}^${o(null!==(r=null===(i=this.ends[n])||void 0===i?void 0:i.latex())&&void 0!==r?r:"")}`}text(){var t,e,i,r;return`${this.ctrlSeq.slice(1,this.ctrlSeq.length-1)}(${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:""},${null!==(r=null===(i=this.ends[n])||void 0===i?void 0:i.text())&&void 0!==r?r:""})`}parser(){const t=this.blocks=[new G,new G];for(const e of t)e.adopt(this,this.ends[n]);return C.optWhitespace.then(C.string("_").or(C.string("^"))).then((e=>{const s=t["_"===e?0:1];return V.block.then((t=>(t.children().adopt(s,s.ends[n]),C.succeed(this))))})).many().result(this)}finalizeTree(){this.downInto=this.ends[s],this.upInto=this.ends[n],this.ends[s].upOutOf=this.ends[n],this.ends[n].downOutOf=this.ends[s]}}class j extends(k($)){constructor(t,e,r,o,l){super(`\\left${o}`,void 0,[e,r]),this.side=t,this.sides={[s]:{ch:e,ctrlSeq:o},[n]:{ch:r,ctrlSeq:l}},this.placeCursor=i,this.siblingCreated=(t,e)=>{e===(this.side===s?n:s)&&this.finalizeTree()}}numBlocks(){return 1}html(){return this.htmlTemplate=`<span class="mq-non-leaf"><span class="mq-scaled mq-paren${this.side===n?" mq-ghost":""}">`+this.sides[s].ch+'</span><span class="mq-non-leaf">&0</span>'+`<span class="mq-scaled mq-paren${this.side===s?" mq-ghost":""}">`+this.sides[n].ch+"</span></span>",super.html()}latex(){var t,e,i,r,o,l;return`\\left${null!==(e=null===(t=this.sides[s])||void 0===t?void 0:t.ctrlSeq)&&void 0!==e?e:""}${null!==(r=null===(i=this.ends[s])||void 0===i?void 0:i.latex())&&void 0!==r?r:""}\\right${null!==(l=null===(o=this.sides[n])||void 0===o?void 0:o.ctrlSeq)&&void 0!==l?l:""}`}text(){var t,e,i,r,o,l;return`${null!==(e=null===(t=this.sides[s])||void 0===t?void 0:t.ch)&&void 0!==e?e:""}${null!==(r=null===(i=this.ends[s])||void 0===i?void 0:i.text())&&void 0!==r?r:""}${null!==(l=null===(o=this.sides[n])||void 0===o?void 0:o.ch)&&void 0!==l?l:""}`}matchBrack(t,e,i){return i instanceof j&&i.side&&i.side!==(e===s?n:e===n?s:void 0)&&(!t.restrictMismatchedBrackets||u[this.sides[this.side].ch]===i.sides[i.side].ch||{"(":"]","[":")"}[this.sides[s].ch]===i.sides[n].ch)&&i}closeOpposing(t){var e;t.side=0,t.sides[this.side]=this.sides[this.side];const n=null===(e=t.delims)||void 0===e?void 0:e[this.side===s?0:1];n&&(n.classList.remove("mq-ghost"),n.innerHTML=this.sides[this.side].ch)}createLeftOf(t){var e,i,r,o,l;let a,c;if(!this.replacedFragment){const r=t.options;if("|"===this.sides[s].ch)a=this.matchBrack(r,n,t[n])||this.matchBrack(r,s,t[s])||this.matchBrack(r,void 0,null===(e=t.parent)||void 0===e?void 0:e.parent);else{const e=this.side===s?n:s;a=this.matchBrack(r,e,t[e])||this.matchBrack(r,e,null===(i=t.parent)||void 0===i?void 0:i.parent)}}a?(c=this.side=a.side===s?n:s,this.closeOpposing(a),a===(null===(r=t.parent)||void 0===r?void 0:r.parent)&&t[c]&&new x(t[c],null===(o=t.parent)||void 0===o?void 0:o.ends[c],c===s?n:s).disown().withDirAdopt(c===s?n:s,a.parent,a,a[c]).elements.insDirOf(c,a.elements),a.bubble("reflow")):(a=this,c=a.side,a.replacedFragment?a.side=0:t[c===s?n:s]&&(a.replaces(new x(t[c===s?n:s],null===(l=t.parent)||void 0===l?void 0:l.ends[c===s?n:s],c)),delete t[c===s?n:s]),super.createLeftOf(t)),c===s?t.insAtLeftEnd(a.ends[s]):t.insRightOf(a)}unwrap(){var t;const e=null===(t=this.ends[s])||void 0===t?void 0:t.children().disown().adopt(this.parent,this,this[n]);e&&this.elements.last.after(...e.elements.contents),this.remove()}deleteSide(t,e,i){var r,o,l,a,c,d,h,p,m,f,v,g;const b=this.parent,w=this[t],q=b.ends[t];if(t===this.side)return this.unwrap(),void(w?i.insDirOf(t===s?n:s,w):i.insAtDirEnd(t,b));const E=!this.side;if(this.side=t===s?n:s,this.matchBrack(i.options,t,null===(r=this.ends[s])||void 0===r?void 0:r.ends[this.side])){this.closeOpposing(null===(o=this.ends[s])||void 0===o?void 0:o.ends[this.side]);const e=null===(l=this.ends[s])||void 0===l?void 0:l.ends[t];this.unwrap(),null===(a=null==e?void 0:e.siblingCreated)||void 0===a||a.call(e,i.options,t),w?i.insDirOf(t===s?n:s,w):i.insAtDirEnd(t,b)}else{if(this.matchBrack(i.options,t,null===(c=this.parent)||void 0===c?void 0:c.parent))(null===(d=this.parent)||void 0===d?void 0:d.parent).closeOpposing(this),(null===(h=this.parent)||void 0===h?void 0:h.parent).unwrap();else{if(e&&E)return this.unwrap(),void(w?i.insDirOf(t===s?n:s,w):i.insAtDirEnd(t,b));this.sides[t]={ch:u[this.sides[this.side].ch],ctrlSeq:u[this.sides[this.side].ctrlSeq]},null===(p=this.delims)||void 0===p||p.forEach(((e,n)=>{e.classList.remove("mq-ghost"),n===(t===s?0:1)&&(e.classList.add("mq-ghost"),e.innerHTML=this.sides[t].ch)}))}if(w){const e=null===(m=this.ends[s])||void 0===m?void 0:m.ends[t];null===(f=this.ends[s])||void 0===f||f.elements.removeClass("mq-empty"),new x(w,q,t===s?n:s).disown().withDirAdopt(t===s?n:s,this.ends[s],e).elements.insAtDirEnd(t,null===(v=this.ends[s])||void 0===v?void 0:v.elements),null===(g=null==e?void 0:e.siblingCreated)||void 0===g||g.call(e,i.options,t),i.insDirOf(t===s?n:s,w)}else e?i.insDirOf(t,this):i.insAtDirEnd(t,this.ends[s])}}deleteTowards(t,e){this.deleteSide(t===s?n:s,!1,e)}finalizeTree(){this.ends[s].deleteOutOf=(t,e)=>{var n;return(null===(n=this.ends[s])||void 0===n?void 0:n.parent).deleteSide(t,!0,e)},this.finalizeTree=()=>{var t;null===(t=this.delims)||void 0===t||t[this.side===s?1:0].classList.remove("mq-ghost"),this.side=0}}}const V=(()=>{const t=t=>{const e=t[0]||new G;for(const s of t.slice(1))s.children().adopt(e,e.ends[n]);return e},e=C.letter.map((t=>new F(t))),s=C.regex(/^\d/).map((t=>new z(t))),i=C.regex(/^[^${}\\_^]/).map((t=>new R(t))),r=C.regex(/^[^\\a-eg-zA-Z]/).or(C.string("\\").then(C.regex(/^[a-z]+/i).or(C.regex(/^\s+/).result(" ")).or(C.any))).then((t=>{const e=d[t];return e?new e(t).parser():C.fail(`unknown command: \\${t}`)})).or(e).or(s).or(i),o=C.string("{").then((()=>a)).skip(C.string("}")),l=C.optWhitespace.then(o.or(r.map((t=>{const e=new G;return t.adopt(e),e})))),a=l.many().map(t).skip(C.optWhitespace),c=C.string("[").then(l.then((t=>"]"!==t.join("latex")?C.succeed(t):C.fail())).many().map(t).skip(C.optWhitespace)).skip(C.string("]")),h=a;return h.block=l,h.optBlock=c,h})(),Q=t=>class extends t{chToCmd(t,e){const s=h[t]||d[t];return t.match(/^[a-eg-zA-Z]$/)?new F(t):/^\d$/.test(t)?new z(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?new d["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?new d["×"](t):s?new s(t):new R(t)}write(t,e){var i;if(this.isSupSubLeft){if(t.options.autoSubscriptNumerals&&this===(null===(i=this.parent)||void 0===i?void 0:i.sub)){if("_"===e)return;const s=this.chToCmd(e,t.options);return s.isSymbol?t.deleteSelection():t.clearSelection().insRightOf(this.parent),void s.createLeftOf(t.show())}t[s]&&!t[n]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent)}const r=this.chToCmd(e,t.options);t.selection&&r.replaces(t.replaceSelection()),t.isTooDeep()||r.createLeftOf(t.show())}};class G extends(L(Q(D))){join(t){return this.foldChildren("",((e,s)=>e+s[t]()))}html(){return this.join("html")}latex(){return this.join("latex")}text(){var t,e;return this.ends[s]&&this.ends[s]===this.ends[n]?null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:"":this.join("text")}keystroke(t,e,i){return i.options.spaceBehavesLikeTab&&i.cursor.depth()>1&&("Spacebar"===t||"Shift-Spacebar"===t)?(e.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?s:n,t,e)):super.keystroke(t,e,i)}moveOutOf(t,e,i){var r;!(i&&(null===(r=this.parent)||void 0===r?void 0:r[`${i}Into`]))&&this[t]?e.insAtDirEnd(t===s?n:s,this[t]):e.insDirOf(t,this.parent)}selectOutOf(t,e){e.insDirOf(t,this.parent)}deleteOutOf(t,e){e.unwrapGramp()}seek(t,e){var i,r,o,l,a,c;let d=this.ends[n];const h=null!==(i=null==d?void 0:d.elements.firstElement.getBoundingClientRect())&&void 0!==i?i:void 0;if(!d||(null!==(r=null==h?void 0:h.left)&&void 0!==r?r:0)+(null!==(o=null==h?void 0:h.width)&&void 0!==o?o:0)<t)e.insAtRightEnd(this);else if(t<(null!==(a=null===(l=this.ends[s])||void 0===l?void 0:l.elements.firstElement.getBoundingClientRect().left)&&void 0!==a?a:0))e.insAtLeftEnd(this);else{for(;t<(null!==(c=null==d?void 0:d.elements.firstElement.getBoundingClientRect().left)&&void 0!==c?c:0);)d=null==d?void 0:d[s];null==d||d.seek(t,e)}}writeLatex(t,e){var i,r,o,l,a,c,d;const h=C.all,u=C.eof,p=V.skip(u).or(h.result(!1)).parse(e);if(p&&!p.isEmpty()&&p.prepareInsertionAt(t)){p.children().adopt(t.parent,t[s],t[n]);const e=p.domify();t.element.before(...e.contents),t[s]=p.ends[n],p.finalizeInsert(t.options,t),null===(o=null===(r=null===(i=p.ends[n])||void 0===i?void 0:i[n])||void 0===r?void 0:r.siblingCreated)||void 0===o||o.call(r,t.options,s),null===(c=null===(a=null===(l=p.ends[s])||void 0===l?void 0:l[s])||void 0===a?void 0:a.siblingCreated)||void 0===c||c.call(a,t.options,n),null===(d=t.parent)||void 0===d||d.bubble("reflow")}}focus(){return super.focus(),this}blur(){return super.blur(),this}}class K extends G{constructor(){super(),y(this)}}class Z extends(Q($)){constructor(t){super("$"),this.cursor=t,this.htmlTemplate='<span class="mq-math-mode">&0</span>'}createBlocks(){super.createBlocks();const t=this.ends[s];t.write=(e,i)=>{var r;"$"!==i?this.write(e,i):t.isEmpty()?(e.insRightOf(t.parent),null===(r=t.parent)||void 0===r||r.deleteTowards(s,e),new R("\\$","$").createLeftOf(e.show())):e[n]?e[s]?this.write(e,i):e.insLeftOf(t.parent):e.insRightOf(t.parent)}}latex(){var t,e;return`$${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}$`}}class X extends O{constructor(t,e){super(t),this.element=document.createElement("span"),this.upDownCache={},this.blink=()=>this.element.classList.toggle("mq-blink"),this.options=e,this.element.classList.add("mq-cursor"),this.element.textContent="​"}show(){var t,e;return this.element.classList.remove("mq-blink"),this.element.style.display="",this.intervalId?clearInterval(this.intervalId):(this[n]?this.selection&&(null===(t=this.selection.ends[s])||void 0===t?void 0:t[s])===this[s]?this.selection.elements.first.before(this.element):this[n].elements.first.before(this.element):this.parent.elements.firstElement.append(this.element),null===(e=this.parent)||void 0===e||e.focus()),this.intervalId=setInterval(this.blink,500),this}hide(){return this.intervalId&&clearInterval(this.intervalId),delete this.intervalId,this.element.style.display="none",this.element.remove(),this}withDirInsertAt(t,e,i,r){const o=this.parent;this.parent=e,this[t]=i,this[t===s?n:s]=r,o!==e&&o.blur&&o.blur(this)}insDirOf(t,e){var n;return a(t),t===s?e.elements.first.before(this.element):e.elements.last.after(this.element),this.withDirInsertAt(t,e.parent,e[t],e),null===(n=this.parent)||void 0===n||n.elements.addClass("mq-has-cursor"),this}insLeftOf(t){return this.insDirOf(s,t)}insRightOf(t){return this.insDirOf(n,t)}insAtDirEnd(t,e){return a(t),t===s?e.elements.firstElement.prepend(this.element):e.elements.lastElement.append(this.element),this.withDirInsertAt(t,e,void 0,e.ends[t]),e.focus(),this}insAtLeftEnd(t){return this.insAtDirEnd(s,t)}insAtRightEnd(t){return this.insAtDirEnd(n,t)}jumpUpDown(t,e){this.upDownCache[t.id]=O.copy(this);const s=this.upDownCache[e.id];s?s[n]?this.insLeftOf(s[n]):this.insAtRightEnd(s.parent):e.seek(this.offset().left,this)}offset(){return this.element.getBoundingClientRect()}unwrapGramp(){var t,e,i,r,o,l,a,c,d,h;const u=null===(t=this.parent)||void 0===t?void 0:t.parent,p=u.parent,m=u[n];let f=u[s];if(u.disown().eachChild((t=>{t.isEmpty()||(t.children().adopt(p,f,m).each((t=>{u.elements.first.before(...t.elements.contents)})),f=t.ends[n])})),!this[n])if(this[s])this[n]=null===(e=this[s])||void 0===e?void 0:e[n];else for(;!this[n];){if(this.parent=null===(i=this.parent)||void 0===i?void 0:i[n],!this.parent){this[n]=u[n],this.parent=p;break}this[n]=null===(r=this.parent)||void 0===r?void 0:r.ends[s]}this[n]?this.insLeftOf(this[n]):this.insAtRightEnd(p),u.elements.remove(),(null===(o=u[s])||void 0===o?void 0:o.siblingDeleted)&&(null===(a=null===(l=u[s])||void 0===l?void 0:l.siblingDeleted)||void 0===a||a.call(l,this.options,n)),(null===(c=u[n])||void 0===c?void 0:c.siblingDeleted)&&(null===(h=null===(d=u[n])||void 0===d?void 0:d.siblingDeleted)||void 0===h||h.call(d,this.options,s))}startSelection(){this.anticursor=O.copy(this),this.anticursor.ancestors={};for(let t=this.anticursor;t.parent;t=t.parent)this.anticursor.ancestors[t.parent.id]=t}endSelection(){delete this.anticursor}select(){var t,e,i,r,o;if(this[s]===(null===(t=this.anticursor)||void 0===t?void 0:t[s])&&this.parent===(null===(e=this.anticursor)||void 0===e?void 0:e.parent))return!1;if(l("selection well formed",!!this.anticursor&&!!this.anticursor.ancestors),!this.anticursor||!this.anticursor.ancestors)return!1;let a=this,c=null;for(;a.parent;a=a.parent)if(a.parent.id in this.anticursor.ancestors){c=a.parent;break}l("cursor and anticursor in the same tree",!!c);const d=this.anticursor.ancestors[null!==(i=null==c?void 0:c.id)&&void 0!==i?i:0];let h,u,p=n;if(a[s]!==d)for(let t=a;t;t=t[n])if(t[n]===d[n]){p=s,h=a,u=d;break}return p===n&&(h=d,u=a),h instanceof O&&(h=h[n]),u instanceof O&&(u=u[s]),this.hide().selection=null==c?void 0:c.selectChildren(h,u),this.insDirOf(p,null===(r=this.selection)||void 0===r?void 0:r.ends[p]),null===(o=this.selectionChanged)||void 0===o||o.call(this),!0}clearSelection(){var t;return this.selection&&(this.selection.clear(),delete this.selection,null===(t=this.selectionChanged)||void 0===t||t.call(this)),this}deleteSelection(){var t,e,i;this.selection&&(this[s]=null===(t=this.selection.ends[s])||void 0===t?void 0:t[s],this[n]=null===(e=this.selection.ends[n])||void 0===e?void 0:e[n],this.selection.remove(),null===(i=this.selectionChanged)||void 0===i||i.call(this),delete this.selection)}replaceSelection(){var t,e;const i=this.selection;return i&&(this[s]=null===(t=i.ends[s])||void 0===t?void 0:t[s],this[n]=null===(e=i.ends[n])||void 0===e?void 0:e[n],delete this.selection),i}depth(){let t=this.parent,e=0;for(;t;)e+=t instanceof G?1:0,t=t.parent;return e}isTooDeep(t){if(void 0!==this.options.maxDepth)return this.depth()+(t||0)>this.options.maxDepth}}const Y=t=>class extends t{scrollHoriz(){const t=this.root.elements.firstElement.getBoundingClientRect();let e=0;if(this.cursor.selection){const i=this.cursor.selection.elements.firstElement.getBoundingClientRect(),r=i.left-(t.left+20),o=i.right-(t.right-20);if(this.cursor.selection.ends[s]===this.cursor[n])if(r<0)e=r;else{if(!(o>0))return;e=i.left-o<t.left+20?r:o}else if(o>0)e=o;else{if(!(r<0))return;e=i.right-r>t.right-20?o:r}}else{const s=this.cursor.element.getBoundingClientRect().left;if(s>t.right-20)e=s-(t.right-20);else{if(!(s<t.left+20))return;e=s-(t.left+20)}}setTimeout((()=>this.root.elements.firstElement.scrollLeft+=e),100)}},J=t=>class extends t{exportLatex(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")}writeLatex(t){var e;const s=this.notify("edit").cursor;return null===(e=s.parent)||void 0===e||e.writeLatex(s,t),this}renderLatexMath(t){const e=V.skip(C.eof).or(C.all.result(!1)).parse(t);if(this.root.eachChild("postOrder","dispose"),delete this.root.ends[s],delete this.root.ends[n],e&&e.prepareInsertionAt(this.cursor)){e.children().adopt(this.root);const t=e.join("html");this.root.elements.html(t),this.root.domify(this.root.elements.children()),this.root.finalizeInsert(this.cursor.options)}else this.root.elements.empty();delete this.cursor.selection,this.cursor.insAtRightEnd(this.root)}renderLatexText(t){this.root.elements.children().contents.slice(1).forEach((t=>t.remove())),this.root.eachChild("postOrder","dispose"),delete this.root.ends[s],delete this.root.ends[n],delete this.cursor.selection,this.cursor.show().insAtRightEnd(this.root);const e=C.string("$").then(V).skip(C.string("$").or(C.eof)).map((t=>{const e=new Z(this.cursor);e.createBlocks();const n=e.ends[s];return t.children().adopt(n),e})),i=C.string("\\$").result("$").or(C.regex(/^[^$]/)).map(R),r=e.or(i).many().skip(C.eof).or(C.all.result(!1)).parse(t);if(r){for(const t of r)t.adopt(this.root,this.root.ends[n]);this.root.elements.lastElement.append(...this.root.domify().contents),this.root.finalizeInsert(this.cursor.options)}}},tt=s=>class extends s{delegateMouseEvents(){const t=this.root.elements.firstElement;this.mouseDownHandler=s=>{var n,r;const o=s.target.closest(".mq-root-block"),l=E.byId[parseInt(null!==(n=(null==o?void 0:o.getAttribute(e))||(null==t?void 0:t.getAttribute(e)))&&void 0!==n?n:"0")];if(!l.controller)throw"controller undefined... what?";const a=l.controller,c=a.cursor,d=c.blink,h=a.textareaSpan,u=a.textarea;if(s.preventDefault(),c.options.ignoreNextMousedown(s))return;c.options.ignoreNextMousedown=()=>!1,c.endSelection();const p=s.target.ownerDocument;let m;const f=t=>m=t.target,v=t=>{var e;c.anticursor||c.startSelection(),a.seek(m,null!==(e=t.pageX)&&void 0!==e?e:0).cursor.select(),m=void 0},g=()=>{c.blink=d,c.selection||(a.editable?c.show():null==h||h.remove()),null==o||o.removeEventListener("mousemove",f),p.removeEventListener("mousemove",v),p.removeEventListener("mouseup",g)};a.blurred&&(a.editable||null==o||o.prepend(h),null==u||u.focus()),c.blink=i,a.seek(s.target,null!==(r=s.pageX)&&void 0!==r?r:0).cursor.startSelection(),null==o||o.addEventListener("mousemove",f),p.addEventListener("mousemove",v),p.addEventListener("mouseup",g)},this.container.addEventListener("mousedown",this.mouseDownHandler)}seek(s,n){var i,r;const o=this.notify("select").cursor;let a=0;if(s&&(a=parseInt(null!==(i=s.getAttribute(e)||s.getAttribute(t))&&void 0!==i?i:"0"),!a)){const n=s.parentElement;a=parseInt(null!==(r=(null==n?void 0:n.getAttribute(e))||(null==n?void 0:n.getAttribute(t)))&&void 0!==r?r:"0")}const c=a?E.byId[a]:this.root;return l("nodeId is the id of some TNode that exists",!!c),o.clearSelection().show(),c.seek(n,o),this.scrollHoriz(),this}},et=t=>class extends t{exportText(){return this.root.foldChildren("",((t,e)=>t+e.text()))}},st=t=>class extends t{createTextarea(){this.textareaSpan=document.createElement("span"),this.textareaSpan.classList.add("mq-textarea");const t=this.options.substituteTextarea();if(!t.nodeType)throw"substituteTextarea() must return a DOM element, got "+t.toString();this.textareaSpan.append(t),this.textarea=t,this.cursor.selectionChanged=()=>this.selectionChanged()}selectionChanged(){this.textareaSelectionTimeout||(this.textareaSelectionTimeout=setTimeout((()=>this.setTextareaSelection())))}setTextareaSelection(){var t;delete this.textareaSelectionTimeout;let e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e=`$${e}$`)),null===(t=this.selectFn)||void 0===t||t.call(this,e)}staticMathTextareaEvents(){var t,e,s,n,i;const r=document.createElement("span");r.classList.add("mq-selectable"),r.textContent=`$${this.exportLatex()}$`,this.container.prepend(r),this.blurred=!0,null===(t=this.textarea)||void 0===t||t.addEventListener("cut",(t=>{t.stopPropagation(),t.preventDefault()})),null===(e=this.textarea)||void 0===e||e.addEventListener("paste",(t=>{t.stopPropagation(),t.preventDefault()})),null===(s=this.textarea)||void 0===s||s.addEventListener("copy",(()=>this.setTextareaSelection())),null===(n=this.textarea)||void 0===n||n.addEventListener("focus",(()=>this.blurred=!1)),null===(i=this.textarea)||void 0===i||i.addEventListener("blur",(()=>{this.cursor.selection&&this.cursor.selection.clear(),setTimeout((()=>{var t;null===(t=this.textareaSpan)||void 0===t||t.remove(),this.blurred=!0}))})),this.selectFn=t=>{var e;this.textarea&&(this.textarea.value=t),t&&(null===(e=this.textarea)||void 0===e||e.select())}}editablesTextareaEvents(){const t=this.options.substituteKeyboardEvents(this.textarea,this);this.selectFn=e=>t.select(e),this.container.prepend(this.textareaSpan),this.focusBlurEvents()}unbindEditablesEvents(){var t,e,s;this.selectFn=t=>{var e;this.textarea&&(this.textarea.value=t),t&&(null===(e=this.textarea)||void 0===e||e.select())},null===(t=this.textareaSpan)||void 0===t||t.remove(),this.unbindFocusBlurEvents(),this.blurred=!0,null===(e=this.textarea)||void 0===e||e.addEventListener("cut",(t=>{t.stopPropagation(),t.preventDefault()})),null===(s=this.textarea)||void 0===s||s.addEventListener("paste",(t=>{t.stopPropagation(),t.preventDefault()}))}typedText(t){var e;if("\n"===t)return this.handle("enter");const s=this.notify().cursor;null===(e=s.parent)||void 0===e||e.write(s,t),this.scrollHoriz()}cut(){this.cursor.selection&&setTimeout((()=>{var t;this.notify("edit"),null===(t=this.cursor.parent)||void 0===t||t.bubble("reflow")}))}copy(){this.setTextareaSelection()}paste(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):`\\text{${t}}`),this.writeLatex(t).cursor.show()}keystroke(t,e){}};class nt{constructor(t,e,s){this.KIND_OF_MQ="",this.editable=!1,this.id=t.id,this.root=t,this.container=e,this.options=s,this.cursor=new X(t,s)}handle(t,e){var i,r;const o=this.options.handlers;o&&o[t]&&(e===s||e===n?null===(i=o[t])||void 0===i||i.call(o,e,this.apiClass):null===(r=o[t])||void 0===r||r.call(o,this.apiClass))}notify(t){return"move"!==t&&"upDown"!==t||this.cursor.show().clearSelection(),"upDown"!==t&&(this.cursor.upDownCache={}),"edit"===t&&this.cursor.show().deleteSelection(),"select"!==t&&this.cursor.endSelection(),this}selectionChanged(){}}class it extends(et(st(J(T(tt(Y(nt))))))){constructor(t,e,s){super(t,e,s),t.controller=this}keystroke(t,e){var s;null===(s=this.cursor.parent)||void 0===s||s.keystroke(t,e,this)}escapeDir(t,e,s){var n;a(t);const i=this.cursor;if(i.parent!==this.root&&s.preventDefault(),i.parent!==this.root)return null===(n=i.parent)||void 0===n||n.moveOutOf(t,i),this.notify("move")}moveDir(t){var e,s;a(t);const n=this.cursor,i=n.options.leftRightIntoCmdGoes;return n.selection?n.insDirOf(t,n.selection.ends[t]):n[t]?null===(e=n[t])||void 0===e||e.moveTowards(t,n,i):null===(s=n.parent)||void 0===s||s.moveOutOf(t,n,i),this.notify("move")}moveLeft(){return this.moveDir(s)}moveRight(){return this.moveDir(n)}moveUpDown(t){var e,i,r,o,l;const a=this.notify("upDown").cursor,c=`${t}Into`,d=`${t}OutOf`;return(null===(e=a[n])||void 0===e?void 0:e[c])?a.insAtLeftEnd(null===(i=a[n])||void 0===i?void 0:i[c]):(null===(r=a[s])||void 0===r?void 0:r[c])?a.insAtRightEnd(null===(o=a[s])||void 0===o?void 0:o[c]):null===(l=a.parent)||void 0===l||l.bubble((t=>{if(t[d]&&("function"==typeof t[d]&&t[d](a),t[d]instanceof E&&a.jumpUpDown(t,t[d]),!0!==t[d]))return!1})),this}moveUp(){return this.moveUpDown("up")}moveDown(){return this.moveUpDown("down")}deleteDir(t){var e,i,r,o,l,c,d,h;a(t);const u=this.cursor,p=u.selection;return this.notify("edit"),p||(u[t]?null===(e=u[t])||void 0===e||e.deleteTowards(t,u):null===(i=u.parent)||void 0===i||i.deleteOutOf(t,u)),null===(r=u[n])||void 0===r||r.postOrder("contactWeld",u),null===(l=null===(o=u[s])||void 0===o?void 0:o.siblingDeleted)||void 0===l||l.call(o,u.options,n),null===(d=null===(c=u[n])||void 0===c?void 0:c.siblingDeleted)||void 0===d||d.call(c,u.options,s),null===(h=u.parent)||void 0===h||h.bubble("reflow"),this}ctrlDeleteDir(t){var e,i,r,o,l,c,d,h;a(t);const u=this.cursor;return!u[t]||u.selection?this.deleteDir(t):(this.notify("edit"),t===s?new x(null===(e=u.parent)||void 0===e?void 0:e.ends[s],u[s]).remove():new x(u[n],null===(i=u.parent)||void 0===i?void 0:i.ends[n]).remove(),u.insAtDirEnd(t,u.parent),null===(r=u[n])||void 0===r||r.postOrder("contactWeld",u),null===(l=null===(o=u[s])||void 0===o?void 0:o.siblingDeleted)||void 0===l||l.call(o,u.options,n),null===(d=null===(c=u[n])||void 0===c?void 0:c.siblingDeleted)||void 0===d||d.call(c,u.options,s),null===(h=u.parent)||void 0===h||h.bubble("reflow"),this)}backspace(){return this.deleteDir(s)}deleteForward(){return this.deleteDir(n)}selectDir(t){var e,i;const r=this.notify("select").cursor,o=r.selection;a(t),r.anticursor||r.startSelection();const l=r[t];l?o&&(null==o?void 0:o.ends[t])===l&&(null===(e=r.anticursor)||void 0===e?void 0:e[t===s?n:s])!==l?l.unselectInto(t,r):l.selectTowards(t,r):null===(i=r.parent)||void 0===i||i.selectOutOf(t,r),r.clearSelection(),r.select()||r.show()}selectLeft(){return this.selectDir(s)}selectRight(){return this.selectDir(n)}}class rt{constructor(t){this.__controller=t,this.__controller.apiClass=this,this.__options=t.options,this.id=t.id}__mathquillify(...t){const s=this.__controller.root,n=this.__controller.container;this.__controller.createTextarea(),n.classList.add(...t);const i=Array.from(n.childNodes).map((t=>n.removeChild(t))),r=document.createElement("span");r.classList.add("mq-root-block"),r.setAttribute(e,s.id.toString()),s.elements.add(r),n.append(r),this.latex(i.reduce(((t,e)=>{var s;return 8===e.nodeType?t:`${t}${null!==(s=e.textContent)&&void 0!==s?s:""}`}),"")),this.revert=()=>{for(;n.firstChild;)n.firstChild.remove();return n.classList.remove("mq-editable-field","mq-math-mode","mq-text-mode"),this.__controller.mouseDownHandler&&n.removeEventListener("mousedown",this.__controller.mouseDownHandler),n.append(...i),n}}config(t){return g.config(this.__options,t),this}el(){return this.__controller.container}text(){return this.__controller.exportText()}latex(t){var e;return void 0!==t?(this.__controller.renderLatexMath(t),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this):this.__controller.exportLatex()}html(){return this.__controller.root.elements.html().replace(new RegExp(` (?:${e}|${t})="?\\d+"?`,"g"),"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-has-cursor|mq-has-cursor ?/,"").replace(/ class=(""|(?= |>))/g,"")}reflow(){return this.__controller.root.postOrder("reflow"),this}}class ot extends rt{__mathquillify(...t){return super.__mathquillify(...t),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this}focus(){var t,e;return document.activeElement===this.__controller.textarea?null===(t=this.__controller.textarea)||void 0===t||t.dispatchEvent(new FocusEvent("focus")):null===(e=this.__controller.textarea)||void 0===e||e.focus(),this}blur(){var t,e;return document.activeElement!==this.__controller.textarea?null===(t=this.__controller.textarea)||void 0===t||t.dispatchEvent(new FocusEvent("blur")):null===(e=this.__controller.textarea)||void 0===e||e.blur(),this}write(t){var e;return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this}empty(){const t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),delete t.ends[s],delete t.ends[n],t.elements.empty(),delete e.selection,e.insAtRightEnd(t),this}cmd(t){var e,s;const n=this.__controller.notify(),i=n.cursor;if(/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()){t=t.slice(1);const e=d[t];if(e){const s=new e(t);i.selection&&s.replaces(i.replaceSelection()),s.createLeftOf(i.show()),this.__controller.scrollHoriz()}}else null===(e=i.parent)||void 0===e||e.write(i,t);return n.blurred&&(null===(s=i.hide().parent)||void 0===s||s.blur()),this}select(){const t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[s];)t.selectLeft();return this}clearSelection(){return this.__controller.cursor.clearSelection(),this}moveToDirEnd(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this}moveToLeftEnd(){return this.moveToDirEnd(s)}moveToRightEnd(){return this.moveToDirEnd(n)}keystroke(t){const e=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(const t of e){const e=new KeyboardEvent("noop");e.preventDefault=i,this.__controller.keystroke(t,e)}return this}typedText(t){for(const e of t)this.__controller.typedText(e);return this}dropEmbedded(t,e,s){const n=document.elementFromPoint(t-window.pageXOffset,e-window.pageYOffset);this.__controller.seek(n,t);(new d.embed).setOptions(s).createLeftOf(this.__controller.cursor)}clickAt(t,e,s){s=s||document.elementFromPoint(t,e);const n=this.__controller,i=n.root;return i.elements.firstElement.contains(s)||(s=i.elements.firstElement),n.seek(s,t+window.pageXOffset),n.blurred&&this.focus(),this}ignoreNextMousedown(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}class lt{push(t){this[Object.keys(this).length]=t}get length(){return Object.keys(this).length}get(t){for(const e of Object.keys(this)){const s=parseInt(e);if(this[s].name===t)return this[s]}}}class at extends rt{constructor(t){super(t),this.__controller.root.postOrder("registerInnerField",this.innerFields=new lt,dt)}__mathquillify(){return super.__mathquillify("mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this}latex(t){const e=super.latex(t);return void 0!==t&&this.__controller.root.postOrder("registerInnerField",this.innerFields=new lt,dt),e}}at.RootBlock=G;class ct extends ot{__mathquillify(){const t=this.__controller.root.reflow;return this.__controller.root.reflow=i,super.__mathquillify("mq-editable-field","mq-math-mode"),t?this.__controller.root.reflow=t:delete this.__controller.root.reflow,this}}ct.RootBlock=K;class dt extends ct{constructor(){super(...arguments),this.name=""}makeStatic(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.classList.remove("mq-editable-field")}makeEditable(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.classList.add("mq-editable-field")}}class ht extends ot{__mathquillify(){return super.__mathquillify("mq-editable-field","mq-text-mode")}latex(t){var e;return void 0!==t?(this.__controller.renderLatexText(t),this.__controller.blurred&&(null===(e=this.__controller.cursor.hide().parent)||void 0===e||e.blur()),this):this.__controller.exportLatex()}}ht.RootBlock=class extends K{keystroke(t,e,s){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return super.keystroke(t,e,s)}write(t,e){t.show().deleteSelection(),"$"===e?new Z(t).createLeftOf(t):new R(e,"<"===e?"&lt;":">"===e?"&gt;":void 0).createLeftOf(t)}};class ut extends ${constructor(t,e,s){super(t,`<${e} ${s}>&0</${e}>`)}}d.mathrm=o(ut,"\\mathrm","span",'class="mq-roman mq-font"'),d.mathit=o(ut,"\\mathit","i",'class="mq-font"'),d.mathbf=o(ut,"\\mathbf","b",'class="mq-font"'),d.mathsf=o(ut,"\\mathsf","span",'class="mq-sans-serif mq-font"'),d.mathtt=o(ut,"\\mathtt","span",'class="mq-monospace mq-font"'),d.underline=o(ut,"\\underline","span",'class="mq-non-leaf mq-underline"'),d.overline=d.bar=o(ut,"\\overline","span",'class="mq-non-leaf mq-overline"'),d.overrightarrow=o(ut,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),d.overleftarrow=o(ut,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),d.overleftrightarrow=o(ut,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),d.overarc=o(ut,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),d.dot=class extends ${constructor(){super("\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}},d.textcolor=class extends ${setColor(t){this.color=t,this.htmlTemplate=`<span class="mq-textcolor" style="color:${t}">&0</span>`}latex(){var t;return`\\textcolor{${null!==(t=this.color)&&void 0!==t?t:""}}{${this.blocks[0].latex()}}`}parser(){return C.optWhitespace.then(C.string("{")).then(C.regex(/^[#\w\s.,()%-]*/)).skip(C.string("}")).then((t=>(this.setColor(t),super.parser())))}isStyleBlock(){return!0}},d.class=class extends ${parser(){return C.optWhitespace.then(C.string("{")).then(C.regex(/^[-\w\s\\\xA0-\xFF]*/)).skip(C.string("}")).then((t=>(this.cls=t||"",this.htmlTemplate=`<span class="mq-class ${t}">&0</span>`,super.parser())))}latex(){var t;return`\\class{${null!==(t=this.cls)&&void 0!==t?t:""}}{${this.blocks[0].latex()}}`}isStyleBlock(){return!0}},d.subscript=d._=class extends H{constructor(){super(),this.supsub="sub",this.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',this.textTemplate=["_"]}finalizeTree(){this.downInto=this.sub=this.ends[s],this.sub.upOutOf=W,super.finalizeTree()}},d.superscript=d.supscript=d["^"]=class extends H{constructor(){super(),this.supsub="sup",this.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',this.textTemplate=["^(",")"]}finalizeTree(){this.upInto=this.sup=this.ends[n],this.sup.downOutOf=W,super.finalizeTree()}};class pt extends U{constructor(t,e){super(t,`<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>${e}</big><span class="mq-from"><span>&0</span></span></span>`,[t.length>1?t.slice(1):t])}createLeftOf(t){super.createLeftOf(t),t.options.sumStartsWithNEquals&&!this.replacedFragment&&(new F("n").createLeftOf(t),(new N).createLeftOf(t))}}d["∑"]=d.sum=d.summation=o(pt,"\\sum ","&sum;"),d["∏"]=d.prod=d.product=o(pt,"\\prod ","&prod;"),d.coprod=d.coproduct=o(pt,"\\coprod ","&#8720;"),d["∫"]=d.int=d.integral=class extends U{constructor(){super("\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')}},d.frac=d.dfrac=d.cfrac=d.fraction=P;const mt=t=>class extends t{createLeftOf(t){var e,i,r;if(!this.replacedFragment){let o=t[s];for(;o&&!(o instanceof I||"text"in d&&o instanceof d.text||o instanceof U||"\\ "===o.ctrlSeq||/^[,;:]$/.test(o.ctrlSeq));)o=o[s];o instanceof U&&o[n]instanceof H&&(o=o[n],o&&o[n]instanceof H&&(null===(e=o[n])||void 0===e?void 0:e.ctrlSeq)!=o.ctrlSeq&&(o=o[n])),o===t[s]||t.isTooDeep(1)||(null===(i=t[s])||void 0===i?void 0:i.elements.hasClass("mq-operator-name"))||(this.replaces(new x((null==o?void 0:o[n])||(null===(r=t.parent)||void 0===r?void 0:r.ends[s]),t[s])),t[s]=o)}super.createLeftOf(t)}};d.over=h["/"]=class extends(mt(P)){};class ft extends ${constructor(){super(),this.ctrlSeq="\\sqrt",this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',this.textTemplate=["sqrt(",")"],this.reflow=()=>{var t;const e=null===(t=this.ends[n])||void 0===t?void 0:t.elements.firstElement;e&&_([e.previousElementSibling],1,e.getBoundingClientRect().height/parseFloat(getComputedStyle(e).fontSize)-.1)}}parser(){return V.optBlock.then((t=>V.block.map((e=>{const s=new vt;return s.blocks=[t,e],t.adopt(s),e.adopt(s,t),s})))).or(super.parser())}}d.sqrt=d["√"]=ft,d.hat=class extends ${constructor(){super("\\hat",'<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',["hat(",")"])}};class vt extends ft{constructor(){super(),this.htmlTemplate='<span class="mq-nthroot mq-non-leaf">&0</span><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',this.textTemplate=["root(",",",")"]}latex(){var t,e,i,r;return`\\sqrt[${null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}]{${null!==(r=null===(i=this.ends[n])||void 0===i?void 0:i.latex())&&void 0!==r?r:""}}`}text(){var t,e,i,r,o,l,a,c;const d=null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:"";if(""===d||"2"===d)return`sqrt(${null!==(r=null===(i=this.ends[n])||void 0===i?void 0:i.text())&&void 0!==r?r:""})`;if(function t(e){return e.controller?e.controller:t(e.parent)}(this).options.rootsAreExponents){const t=this[n]instanceof H&&"sup"===this[n].supsub;return`${t?"(":""}(${null!==(l=null===(o=this.ends[n])||void 0===o?void 0:o.text())&&void 0!==l?l:""})^(1/${d})${t?")":""}`}return`root(${d},${null!==(c=null===(a=this.ends[n])||void 0===a?void 0:a.text())&&void 0!==c?c:""})`}}d.root=d.nthroot=vt;class gt extends ${constructor(t,e,s){super(t,`<span class="mq-non-leaf"><span class="mq-diacritic-above">${e}</span><span class="mq-diacritic-stem">&0</span></span>`,s)}}d.vec=o(gt,"\\vec","&rarr;",["vec(",")"]),d.tilde=o(gt,"\\tilde","~",["tilde(",")"]);const bt=(t,e)=>{const i=e||t,r=u[t],l=u[i];h[t]=o(j,s,t,r,i,l),h[r]=o(j,n,t,r,i,l)};bt("("),bt("["),bt("{","\\{"),d.langle=o(j,s,"&lang;","&rang;","\\langle ","\\rangle "),d.rangle=o(j,n,"&lang;","&rang;","\\langle ","\\rangle "),d.abs=h["|"]=o(j,s,"|","|","|","|"),d.lVert=o(j,s,"&#8741;","&#8741;","\\lVert ","\\rVert "),d.rVert=o(j,n,"&#8741;","&#8741;","\\lVert ","\\rVert "),d.left=class extends ${parser(){return C.optWhitespace.then(C.regex(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then((t=>{let e="\\"===t.charAt(0)?t.slice(1):t;return"\\langle"==t&&(e="&lang;",t+=" "),"\\lVert"==t&&(e="&#8741;",t+=" "),V.then((s=>C.string("\\right").skip(C.optWhitespace).then(C.regex(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map((n=>{let i="\\"===n.charAt(0)?n.slice(1):n;"\\rangle"==n&&(i="&rang;",n=`${n} `),"\\rVert"==n&&(i="&#8741;",n=`${n} `);const r=new j(0,e,i,t,n);return r.blocks=[s],s.adopt(r),r}))))}))}},d.right=class extends ${parser(){return C.fail("unmatched \\right")}};class xt extends(k($)){constructor(){super("\\binom",'<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',["choose(",",",")"])}}d.binom=d.binomial=xt,d.choose=class extends(mt(xt)){},d.editable=d.MathQuillMathField=class extends ${constructor(){super("\\MathQuillMathField",'<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>'),this.name=""}parser(){return C.string("[").then(C.regex(/^[a-z][a-z0-9]*/i)).skip(C.string("]")).map((t=>this.name=t)).or(C.succeed()).then(super.parser())}finalizeTree(t){const e=new it(this.ends[s],this.elements.firstElement,t);e.KIND_OF_MQ="MathField",this.field=new dt(e),this.field.name=this.name,e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),y(e.root),this.field.blur()}registerInnerField(t){t.push(this.field)}latex(){var t,e;return null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:""}text(){var t,e;return null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.text())&&void 0!==e?e:""}},d.embed=class extends A{setOptions(t){const e=()=>"";return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this}parser(){return C.string("{").then(C.regex(/^[a-z][a-z0-9]*/i)).skip(C.string("}")).then((t=>C.string("[").then(C.regex(/^[-\w\s]*/)).skip(C.string("]")).or(C.succeed()).map((e=>this.setOptions(p[t](e))))))}};class wt extends(L(S(E))){constructor(){super(),this.anticursorPosition=0,this.ctrlSeq="\\text"}replaces(t){t instanceof x?this.replacedText=t.remove().elements.text():"string"==typeof t&&(this.replacedText=t)}addToElements(t){var e;super.addToElements(t),null===(e=this.ends[s])||void 0===e||e.addToElements(this.elements.first.firstChild)}createLeftOf(t){var e,i,r,o;if(super.createLeftOf(t),t.insAtRightEnd(this),this.replacedText)for(const e of this.replacedText)this.write(t,e);null===(i=null===(e=this[n])||void 0===e?void 0:e.siblingCreated)||void 0===i||i.call(e,t.options,s),null===(o=null===(r=this[s])||void 0===r?void 0:r.siblingCreated)||void 0===o||o.call(r,t.options,n),this.bubble("reflow")}parser(){return C.optWhitespace.then(C.string("{")).then(C.regex(/^(\\}|[^}])*/)).skip(C.string("}")).map((t=>0===t.length?new x:(new qt(t.replace(/\\{/g,"{").replace(/\\}/g,"}")).adopt(this),this)))}textContents(){return this.foldChildren("",((t,e)=>t+e.text()))}text(){return this.textContents()}latex(){const t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/[{}]/g,"\\$&")+"}"}html(){return`<span class="mq-text-mode" ${t}=${this.id}>${this.textContents()}</span>`}moveTowards(t,e){e.insAtDirEnd(t===s?n:s,this)}moveOutOf(t,e){e.insDirOf(t,this)}unselectInto(t,e){e.insAtDirEnd(t===s?n:s,this);const i=e[t].splitRight(this.anticursorPosition);t===s&&(e[s]=i),e.anticursor=new O(this,i[s],i),e.anticursor.ancestors={};for(let t=e.anticursor;t.parent;t=t.parent)e.anticursor.ancestors[t.parent.id]=t}selectOutOf(t,e){var n,i,r,o,l,a;this.anticursorPosition=t===s?(null!==(r=null===(i=null===(n=e.selection)||void 0===n?void 0:n.elements.first.textContent)||void 0===i?void 0:i.length)&&void 0!==r?r:1)-1:this.textContents().length-(null!==(a=null===(l=null===(o=e.selection)||void 0===o?void 0:o.elements.first.textContent)||void 0===l?void 0:l.length)&&void 0!==a?a:1)+1,e.insDirOf(t,this)}deleteOutOf(t,e){this.isEmpty()&&e.insRightOf(this)}write(t,e){if(t.show().deleteSelection(),"$"!==e)this.postOrder("reflow"),t[s]?t[s].appendText(e):new qt(e).createLeftOf(t),this.bubble("reflow");else if(this.isEmpty())t.insRightOf(this),new R("\\$","$").createLeftOf(t);else if(t[n])if(t[s]){const e=new wt,n=this.ends[s];n.disown().elements.detach(),n.adopt(e),t.insLeftOf(this),super.createLeftOf.call(e,t)}else t.insLeftOf(this);else t.insRightOf(this);this.bubble("reflow")}writeLatex(t,e){t[s]?t[s].appendText(e):new qt(e).createLeftOf(t),this.bubble("reflow")}seek(t,e){var i,r,o,l,a,c;e.hide();const d=this.fuseChildren(),h=getComputedStyle(this.elements.firstElement),u=(this.elements.firstElement.getBoundingClientRect().width-parseFloat(h.paddingLeft)-parseFloat(h.paddingRight))/this.text().length,p=Math.round((t-this.elements.firstElement.getBoundingClientRect().left)/u);p<=0?e.insAtLeftEnd(this):p>=d.text().length?e.insAtRightEnd(this):e.insLeftOf(d.splitRight(p));let m=t-e.show().offset().left;const f=m&&m<0?s:n;let v=f;for(;e[f]&&m*v>0;)null===(i=e[f])||void 0===i||i.moveTowards(f,e),v=m,m=t-e.offset().left;if(f*m<-f*v&&(null===(r=e[f===s?n:s])||void 0===r||r.moveTowards(f===s?n:s,e)),e.anticursor){if(e.anticursor.parent===this){const t=null!==(c=e[s]&&(null===(a=e[s])||void 0===a?void 0:a.text().length))&&void 0!==c?c:0;if(this.anticursorPosition===t)e.startSelection();else{let i;this.anticursorPosition<t?(i=e[s].splitRight(this.anticursorPosition),e[s]=i):i=e[n].splitRight(this.anticursorPosition-t),e.anticursor=new O(this,i[s],i),e.anticursor.ancestors={};for(let t=e.anticursor;t.parent;t=t.parent)e.anticursor.ancestors[t.parent.id]=t}}}else this.anticursorPosition=null!==(l=e[s]&&(null===(o=e[s])||void 0===o?void 0:o.text().length))&&void 0!==l?l:0}blur(t){super.blur(),t&&(""===this.textContents()?(this.remove(),t[s]===this?t[s]=this[s]:t[n]===this&&(t[n]=this[n])):(this.elements.find(".mq-selection").contents.length&&t.clearSelection(),this.fuseChildren()),function t(e){return(null==e?void 0:e.controller)?null==e?void 0:e.controller:t(null==e?void 0:e.parent)}(t.parent).handle("textBlockExit"))}fuseChildren(){this.elements.first.normalize();const t=this.elements.first.firstChild;if(!t)return;l("only node in TextBlock span is Text node",3===t.nodeType);const e=new qt(t.data);return e.addToElements(t),this.children().disown(),e.adopt(this)}focus(){super.focus(),function t(e){return(null==e?void 0:e.controller)?null==e?void 0:e.controller:t(null==e?void 0:e.parent)}(this).handle("textBlockEnter")}}class qt extends E{constructor(t){super(),this.textStr=t}text(){return this.textStr}addToElements(t){this.dom=t,this.elements=new b(t)}domify(){return this.addToElements(document.createTextNode(this.textStr)),this.elements}appendText(t){var e;this.textStr+=t,null===(e=this.dom)||void 0===e||e.appendData(t)}prependText(t){var e;this.textStr=t+this.textStr,null===(e=this.dom)||void 0===e||e.insertData(0,t)}insTextAtDirEnd(t,e){a(e),e===n?this.appendText(t):this.prependText(t)}splitRight(t){var e;const s=new qt(this.textStr.slice(t)).adopt(this.parent,this,this[n]);return s.addToElements(null===(e=this.dom)||void 0===e?void 0:e.splitText(t)),this.textStr=this.textStr.slice(0,t),s}endChar(t,e){return e.charAt(t===s?0:-1+e.length)}moveTowards(t,e){a(t);const i=this.endChar(t===s?n:s,this.textStr),r=this[t===s?n:s];return r?r.insTextAtDirEnd(i,t):new qt(i).createDir(t===s?n:s,e),this.deleteTowards(t,e)}latex(){return this.textStr}deleteTowards(t,e){var s,i;this.textStr.length>1?t===n?(null===(s=this.dom)||void 0===s||s.deleteData(0,1),this.textStr=this.textStr.slice(1)):(null===(i=this.dom)||void 0===i||i.deleteData(-1+this.textStr.length,1),this.textStr=this.textStr.slice(0,-1)):(this.remove(),this.elements.remove(),e[t]=this[t])}selectTowards(t,e){a(t);const i=e.anticursor,r=this.endChar(t===s?n:s,this.textStr);if((null==i?void 0:i[t])===this){const s=new qt(r).createDir(t,e);i[t]=s,e.insDirOf(t,s)}else{const o=this[t===s?n:s];if(o)o.insTextAtDirEnd(r,t);else{const i=new qt(r).createDir(t===s?n:s,e);e.selection&&i.elements.insDirOf(t===s?n:s,e.selection.elements)}1===this.textStr.length&&(null==i?void 0:i[t===s?n:s])===this&&(i[t===s?n:s]=this[t===s?n:s])}return this.deleteTowards(t,e)}}d.text=d.textnormal=d.textrm=d.textup=h['"']=d.textmd=wt;const Et=(t,e,s)=>class extends wt{constructor(){super(),this.ctrlSeq=t,this.htmlTemplate=`<${e} ${s}>&0</${e}>`}};d.em=d.italic=d.italics=d.emph=d.textit=d.textsl=Et("\\textit","i",'class="mq-text-mode"'),d.strong=d.bold=d.textbf=Et("\\textbf","b",'class="mq-text-mode"'),d.sf=d.textsf=Et("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),d.tt=d.texttt=Et("\\texttt","span",'class="mq-monospace mq-text-mode"'),d.textsc=Et("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),d.uppercase=Et("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),d.lowercase=Et("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),h["\\"]=class extends ${constructor(){super(),this.ctrlSeq="\\",this.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',this.textTemplate=["\\"]}replaces(t){this._replacedFragment=null==t?void 0:t.disown(),this.isEmpty=()=>!1}createBlocks(){super.createBlocks();const t=this.ends[s];t.focus=()=>{var e,s;return null===(e=t.parent)||void 0===e||e.elements.addClass("mq-has-cursor"),t.isEmpty()&&(null===(s=t.parent)||void 0===s||s.elements.removeClass("mq-empty")),t},t.blur=()=>{var e,s;return null===(e=t.parent)||void 0===e||e.elements.removeClass("mq-has-cursor"),t.isEmpty()&&(null===(s=t.parent)||void 0===s||s.elements.addClass("mq-empty")),t},t.write=(e,s)=>{var n;e.show().deleteSelection(),s.match(/[a-z]/i)?new R(s).createLeftOf(e):(t.parent.renderCommand(e),"\\"===s&&t.isEmpty()||null===(n=e.parent)||void 0===n||n.write(e,s))},t.keystroke=(e,s,n)=>"Tab"===e||"Enter"===e||"Spacebar"===e?(t.parent.renderCommand(n.cursor),void s.preventDefault()):super.keystroke(e,s,n)}createLeftOf(t){if(super.createLeftOf(t),this._replacedFragment){const t=this.elements.first;this._replacedFragment.elements.addClass("mq-blur"),this.elements.first.before(...this._replacedFragment.elements.contents),this.elements.add(this._replacedFragment.elements);const e=e=>{e.stopPropagation(),e.preventDefault(),t.dispatchEvent(new MouseEvent(e.type,e))};this.elements.firstElement.addEventListener("mousedown",e),this.elements.firstElement.addEventListener("mousemove",e)}}latex(){var t,e;return"\\"+(null!==(e=null===(t=this.ends[s])||void 0===t?void 0:t.latex())&&void 0!==e?e:"")+" "}renderCommand(t){var e;this.elements=new b(this.elements.last),this.remove(),this[n]?t.insLeftOf(this[n]):t.insAtRightEnd(this.parent);const i=(null===(e=this.ends[s])||void 0===e?void 0:e.latex())||" ";if(i in d){const e=new d[i](i);this._replacedFragment&&e.replaces(this._replacedFragment),e.createLeftOf(t)}else{const e=new wt;e.replaces(i),e.createLeftOf(t),t.insRightOf(e),this._replacedFragment&&this._replacedFragment.remove()}}};class Ot extends A{constructor(t){super(),this.ctrlSeq=t}createLeftOf(t){for(const e of this.ctrlSeq)new F(e).createLeftOf(t)}parser(){const t=new G;for(const e of this.ctrlSeq)new F(e).adopt(t,t.ends[n]);return C.succeed(t.children())}}for(const t in g.autoOperatorNames)"_maxLength"!==t&&(d[t]=Ot);d.operatorname=class extends ${constructor(t,e,s){super(t,e,s),this.createLeftOf=i}numBlocks(){return 1}parser(){return V.block.map((t=>t.children()))}},d.f=class extends F{constructor(){super("f",'<var class="mq-f">f</var>'),this.letter="f"}italicize(t){return this.elements.html("f"),this.elements.toggleClass("mq-f",t),super.italicize(t)}},d[" "]=d.space=o(R,"\\ ","&nbsp;"),d["'"]=d.prime=o(R,"'","&prime;"),d.backslash=o(R,"\\backslash ","\\"),h["\\"]||(h["\\"]=d.backslash),d.$=o(R,"\\$","$");class yt extends A{constructor(t,e){super(t,`<span class="mq-non-symbola">${e||t}</span>`)}}d["@"]=yt,d["&"]=o(yt,"\\&","&amp;"),d["%"]=o(yt,"\\%","%"),d.alpha=d.beta=d.gamma=d.delta=d.zeta=d.eta=d.theta=d.iota=d.kappa=d.mu=d.nu=d.xi=d.rho=d.sigma=d.tau=d.chi=d.psi=d.omega=class extends M{constructor(t){super(`\\${t} `,`&${t};`)}},d.phi=o(M,"\\phi ","&#981;"),d.phiv=d.varphi=o(M,"\\varphi ","&phi;"),d.epsilon=o(M,"\\epsilon ","&#1013;"),d.epsiv=d.varepsilon=o(M,"\\varepsilon ","&epsilon;"),d.piv=d.varpi=o(M,"\\varpi ","&piv;"),d.sigmaf=d.sigmav=d.varsigma=o(M,"\\varsigma ","&sigmaf;"),d.thetav=d.vartheta=d.thetasym=o(M,"\\vartheta ","&thetasym;"),d.upsilon=d.upsi=o(M,"\\upsilon ","&upsilon;"),d.gammad=d.Gammad=d.digamma=o(M,"\\digamma ","&#989;"),d.kappav=d.varkappa=o(M,"\\varkappa ","&#1008;"),d.rhov=d.varrho=o(M,"\\varrho ","&#1009;"),d.pi=d["π"]=o(yt,"\\pi ","&pi;"),d.lambda=o(yt,"\\lambda ","&lambda;"),d.Upsilon=d.Upsi=d.upsih=d.Upsih=o(A,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),d.Gamma=d.Delta=d.Theta=d.Lambda=d.Xi=d.Pi=d.Sigma=d.Phi=d.Psi=d.Omega=d.forall=class extends R{constructor(t){super(`\\${t} `,`&${t};`)}};class St extends ${constructor(t){super(),this.latex=()=>t}createLeftOf(t){var e,i,r,o,l,a,c;const d=V.parse(this.latex());d.children().adopt(t.parent,t[s],t[n]),t[s]=d.ends[n],t.element.before(...d.domify().contents),d.finalizeInsert(t.options,t),null===(r=null===(i=null===(e=d.ends[n])||void 0===e?void 0:e[n])||void 0===i?void 0:i.siblingCreated)||void 0===r||r.call(i,t.options,s),null===(a=null===(l=null===(o=d.ends[s])||void 0===o?void 0:o[s])||void 0===l?void 0:l.siblingCreated)||void 0===a||a.call(l,t.options,n),null===(c=t.parent)||void 0===c||c.bubble("reflow")}parser(){const t=V.parse(this.latex());return C.succeed(t.children())}}d["¹"]=o(St,"^1"),d["²"]=o(St,"^2"),d["³"]=o(St,"^3"),d["¼"]=o(St,"\\frac14"),d["½"]=o(St,"\\frac12"),d["¾"]=o(St,"\\frac34");class _t extends I{constructor(t,e,s){super(t,`<span>${e||t}</span>`,s,!0),this.siblingCreated=this.siblingDeleted=(t,e)=>this.contactWeld(t,e)}contactWeld(t,e){const i=t=>t[s]?!!(t[s]instanceof I||/^[,;:([]$/.test(t[s].ctrlSeq)):!(t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock())||i(t.parent.parent);if(e!==n)return this.isUnary=i(this),this.elements.firstElement.className=this.isUnary?"":"mq-binary-operator",this}}d["+"]=o(_t,"+","+"),d["–"]=d["-"]=o(_t,"-","&minus;"),d["±"]=d.pm=d.plusmn=d.plusminus=o(_t,"\\pm ","&plusmn;"),d.mp=d.mnplus=d.minusplus=o(_t,"\\mp ","&#8723;"),h["*"]=d.sdot=d.cdot=o(I,"\\cdot ","&middot;","*");const kt={ctrlSeq:"\\le ",html:"&le;",text:"<=",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Ct={ctrlSeq:"\\ge ",html:"&ge;",text:">=",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};d["<"]=d.lt=o(B,kt,!0),d[">"]=d.gt=o(B,Ct,!0),d["≤"]=d.le=d.leq=o(B,kt,!1),d["≥"]=d.ge=d.geq=o(B,Ct,!1),d["="]=N,d["×"]=d.times=o(I,"\\times ","&times;","*"),d["÷"]=d.div=d.divide=d.divides=o(I,"\\div ","&divide;","/"),h["~"]=d.sim=o(I,"\\sim ","~","~"),d.notin=d.cong=d.equiv=d.oplus=d.otimes=class extends I{constructor(t){super(`\\${t} `,`&${t};`)}},d["≠"]=d.ne=d.neq=o(I,"\\ne ","&ne;"),d["∗"]=d.ast=d.star=d.loast=d.lowast=o(I,"\\ast ","&lowast;"),d.therefor=d.therefore=o(I,"\\therefore ","&there4;"),d.cuz=d.because=o(I,"\\because ","&#8757;"),d.prop=d.propto=o(I,"\\propto ","&prop;"),d["≈"]=d.asymp=d.approx=o(I,"\\approx ","&asymp;"),d.isin=d.in=o(I,"\\in ","&isin;"),d.ni=d.contains=o(I,"\\ni ","&ni;"),d.notni=d.niton=d.notcontains=d.doesnotcontain=o(I,"\\not\\ni ","&#8716;"),d.sub=d.subset=o(I,"\\subset ","&sub;"),d.sup=d.supset=d.superset=o(I,"\\supset ","&sup;"),d.nsub=d.notsub=d.nsubset=d.notsubset=o(I,"\\not\\subset ","&#8836;"),d.nsup=d.notsup=d.nsupset=d.notsupset=d.nsuperset=d.notsuperset=o(I,"\\not\\supset ","&#8837;"),d.sube=d.subeq=d.subsete=d.subseteq=o(I,"\\subseteq ","&sube;"),d.supe=d.supeq=d.supsete=d.supseteq=d.supersete=d.superseteq=o(I,"\\supseteq ","&supe;"),d.nsube=d.nsubeq=d.notsube=d.notsubeq=d.nsubsete=d.nsubseteq=d.notsubsete=d.notsubseteq=o(I,"\\not\\subseteq ","&#8840;"),d.nsupe=d.nsupeq=d.notsupe=d.notsupeq=d.nsupsete=d.nsupseteq=d.notsupsete=d.notsupseteq=d.nsupersete=d.nsuperseteq=d.notsupersete=d.notsuperseteq=o(I,"\\not\\supseteq ","&#8841;"),d.mathbb=class extends ${constructor(t,e,s){super(t,e,s),this.createLeftOf=i}numBlocks(){return 1}parser(){return C.optWhitespace.then(C.string("{")).then(C.optWhitespace).then(C.regex(/^[NPZQRCH]/)).skip(C.optWhitespace).skip(C.string("}")).map((t=>new d[t]))}},d.N=d.naturals=d.Naturals=o(R,"\\mathbb{N}","&#8469;"),d.P=d.primes=d.Primes=d.projective=d.Projective=d.probability=d.Probability=o(R,"\\mathbb{P}","&#8473;"),d.Z=d.integers=d.Integers=o(R,"\\mathbb{Z}","&#8484;"),d.Q=d.rationals=d.Rationals=o(R,"\\mathbb{Q}","&#8474;"),d.R=d.reals=d.Reals=o(R,"\\mathbb{R}","&#8477;"),d.C=d.complex=d.Complex=d.complexes=d.Complexes=d.complexplane=d.Complexplane=d.ComplexPlane=o(R,"\\mathbb{C}","&#8450;"),d.H=d.Hamiltonian=d.quaternions=d.Quaternions=o(R,"\\mathbb{H}","&#8461;"),d.quad=d.emsp=o(R,"\\quad ","    "),d.qquad=o(R,"\\qquad ","        "),d.diamond=o(R,"\\diamond ","&#9671;"),d.bigtriangleup=o(R,"\\bigtriangleup ","&#9651;"),d.ominus=o(R,"\\ominus ","&#8854;"),d.uplus=o(R,"\\uplus ","&#8846;"),d.bigtriangledown=o(R,"\\bigtriangledown ","&#9661;"),d.sqcap=o(R,"\\sqcap ","&#8851;"),d.triangleleft=o(R,"\\triangleleft ","&#8882;"),d.sqcup=o(R,"\\sqcup ","&#8852;"),d.triangleright=o(R,"\\triangleright ","&#8883;"),d.odot=d.circledot=o(R,"\\odot ","&#8857;"),d.bigcirc=o(R,"\\bigcirc ","&#9711;"),d.dagger=o(R,"\\dagger ","&#0134;"),d.ddagger=o(R,"\\ddagger ","&#135;"),d.wr=o(R,"\\wr ","&#8768;"),d.amalg=o(R,"\\amalg ","&#8720;"),d.models=o(R,"\\models ","&#8872;"),d.prec=o(R,"\\prec ","&#8826;"),d.succ=o(R,"\\succ ","&#8827;"),d.preceq=o(R,"\\preceq ","&#8828;"),d.succeq=o(R,"\\succeq ","&#8829;"),d.simeq=o(R,"\\simeq ","&#8771;"),d.mid=o(R,"\\mid ","&#8739;"),d.ll=o(R,"\\ll ","&#8810;"),d.gg=o(R,"\\gg ","&#8811;"),d.parallel=o(R,"\\parallel ","&#8741;"),d.nparallel=o(R,"\\nparallel ","&#8742;"),d.bowtie=o(R,"\\bowtie ","&#8904;"),d.sqsubset=o(R,"\\sqsubset ","&#8847;"),d.sqsupset=o(R,"\\sqsupset ","&#8848;"),d.smile=o(R,"\\smile ","&#8995;"),d.sqsubseteq=o(R,"\\sqsubseteq ","&#8849;"),d.sqsupseteq=o(R,"\\sqsupseteq ","&#8850;"),d.doteq=o(R,"\\doteq ","&#8784;"),d.frown=o(R,"\\frown ","&#8994;"),d.vdash=o(R,"\\vdash ","&#8870;"),d.dashv=o(R,"\\dashv ","&#8867;"),d.nless=o(R,"\\nless ","&#8814;"),d.ngtr=o(R,"\\ngtr ","&#8815;"),d.longleftarrow=o(R,"\\longleftarrow ","&#8592;"),d.longrightarrow=o(R,"\\longrightarrow ","&#8594;"),d.Longleftarrow=o(R,"\\Longleftarrow ","&#8656;"),d.Longrightarrow=o(R,"\\Longrightarrow ","&#8658;"),d.longleftrightarrow=o(R,"\\longleftrightarrow ","&#8596;"),d.updownarrow=o(R,"\\updownarrow ","&#8597;"),d.Longleftrightarrow=o(R,"\\Longleftrightarrow ","&#8660;"),d.Updownarrow=o(R,"\\Updownarrow ","&#8661;"),d.mapsto=o(R,"\\mapsto ","&#8614;"),d.nearrow=o(R,"\\nearrow ","&#8599;"),d.hookleftarrow=o(R,"\\hookleftarrow ","&#8617;"),d.hookrightarrow=o(R,"\\hookrightarrow ","&#8618;"),d.searrow=o(R,"\\searrow ","&#8600;"),d.leftharpoonup=o(R,"\\leftharpoonup ","&#8636;"),d.rightharpoonup=o(R,"\\rightharpoonup ","&#8640;"),d.swarrow=o(R,"\\swarrow ","&#8601;"),d.leftharpoondown=o(R,"\\leftharpoondown ","&#8637;"),d.rightharpoondown=o(R,"\\rightharpoondown ","&#8641;"),d.nwarrow=o(R,"\\nwarrow ","&#8598;"),d.ldots=o(R,"\\ldots ","&#8230;"),d.cdots=o(R,"\\cdots ","&#8943;"),d.vdots=o(R,"\\vdots ","&#8942;"),d.ddots=o(R,"\\ddots ","&#8945;"),d.surd=o(R,"\\surd ","&#8730;"),d.triangle=o(R,"\\triangle ","&#9651;"),d.ell=o(R,"\\ell ","&#8467;"),d.top=o(R,"\\top ","&#8868;"),d.flat=o(R,"\\flat ","&#9837;"),d.natural=o(R,"\\natural ","&#9838;"),d.sharp=o(R,"\\sharp ","&#9839;"),d.wp=o(R,"\\wp ","&#8472;"),d.bot=o(R,"\\bot ","&#8869;"),d.clubsuit=o(R,"\\clubsuit ","&#9827;"),d.diamondsuit=o(R,"\\diamondsuit ","&#9826;"),d.heartsuit=o(R,"\\heartsuit ","&#9825;"),d.spadesuit=o(R,"\\spadesuit ","&#9824;"),d.parallelogram=o(R,"\\parallelogram ","&#9649;"),d.square=o(R,"\\square ","&#11036;"),d.oint=o(R,"\\oint ","&#8750;"),d.bigcap=o(R,"\\bigcap ","&#8745;"),d.bigcup=o(R,"\\bigcup ","&#8746;"),d.bigsqcup=o(R,"\\bigsqcup ","&#8852;"),d.bigvee=o(R,"\\bigvee ","&#8744;"),d.bigwedge=o(R,"\\bigwedge ","&#8743;"),d.bigodot=o(R,"\\bigodot ","&#8857;"),d.bigotimes=o(R,"\\bigotimes ","&#8855;"),d.bigoplus=o(R,"\\bigoplus ","&#8853;"),d.biguplus=o(R,"\\biguplus ","&#8846;"),d.lfloor=o(R,"\\lfloor ","&#8970;"),d.rfloor=o(R,"\\rfloor ","&#8971;"),d.lceil=o(R,"\\lceil ","&#8968;"),d.rceil=o(R,"\\rceil ","&#8969;"),d.opencurlybrace=d.lbrace=o(R,"\\lbrace ","{"),d.closecurlybrace=d.rbrace=o(R,"\\rbrace ","}"),d.lbrack=o(R,"["),d.rbrack=o(R,"]"),d.slash=o(R,"/"),d.vert=o(R,"|"),d.perp=d.perpendicular=o(R,"\\perp ","&perp;"),d.nabla=d.del=o(R,"\\nabla ","&nabla;"),d.hbar=o(R,"\\hbar ","&#8463;"),d.AA=d.Angstrom=d.angstrom=o(R,"\\text\\AA ","&#8491;"),d.ring=d.circ=d.circle=o(R,"\\circ ","&#8728;"),d.bull=d.bullet=o(R,"\\bullet ","&bull;"),d.setminus=d.smallsetminus=o(R,"\\setminus ","&#8726;"),d.not=d["¬"]=d.neg=o(R,"\\neg ","&not;"),d["…"]=d.dots=d.ellip=d.hellip=d.ellipsis=d.hellipsis=o(R,"\\dots ","&hellip;"),d.converges=d.darr=d.dnarr=d.dnarrow=d.downarrow=o(R,"\\downarrow ","&darr;"),d.dArr=d.dnArr=d.dnArrow=d.Downarrow=o(R,"\\Downarrow ","&dArr;"),d.diverges=d.uarr=d.uparrow=o(R,"\\uparrow ","&uarr;"),d.uArr=d.Uparrow=o(R,"\\Uparrow ","&uArr;"),d.to=o(I,"\\to ","&rarr;"),d.rarr=d.rightarrow=o(R,"\\rightarrow ","&rarr;"),d.implies=o(I,"\\Rightarrow ","&rArr;"),d.rArr=d.Rightarrow=o(R,"\\Rightarrow ","&rArr;"),d.gets=o(I,"\\gets ","&larr;"),d.larr=d.leftarrow=o(R,"\\leftarrow ","&larr;"),d.impliedby=o(I,"\\Leftarrow ","&lArr;"),d.lArr=d.Leftarrow=o(R,"\\Leftarrow ","&lArr;"),d.harr=d.lrarr=d.leftrightarrow=o(R,"\\leftrightarrow ","&harr;"),d.iff=o(I,"\\Leftrightarrow ","&hArr;"),d.hArr=d.lrArr=d.Leftrightarrow=o(R,"\\Leftrightarrow ","&hArr;"),d.Re=d.Real=d.real=o(R,"\\Re ","&real;"),d.Im=d.imag=d.image=d.imagin=d.imaginary=d.Imaginary=o(R,"\\Im ","&image;"),d.part=d.partial=o(R,"\\partial ","&part;"),d.inf=d.infty=d.infin=d.infinity=o(R,"\\infty ","&infin;","inf"),d.pounds=o(R,"\\pounds ","&pound;"),d.alef=d.alefsym=d.aleph=d.alephsym=o(R,"\\aleph ","&alefsym;"),d.xist=d.xists=d.exist=d.exists=o(R,"\\exists ","&exist;"),d.nexists=d.nexist=o(R,"\\nexists ","&#8708;"),d.and=d.land=d.wedge=o(I,"\\wedge ","&and;"),d.or=d.lor=d.vee=o(I,"\\vee ","&or;"),d.o=d.O=d.empty=d.emptyset=d.oslash=d.Oslash=d.nothing=d.varnothing=o(I,"\\varnothing ","&empty;"),d.U=d.cup=d.union=o(I,"\\cup ","&cup;","U"),d.cap=d.intersect=d.intersection=o(I,"\\cap ","&cap;"),d.deg=d.degree=o(R,"\\degree ","&deg;"),d.ang=d.angle=o(R,"\\angle ","&ang;"),d.measuredangle=o(R,"\\measuredangle ","&#8737;");class Tt{static getInterface(){const t={},s=t=>{var s,n;if(!(t instanceof HTMLElement))return;const i=null!==(n=null===(s=t.querySelector(".mq-root-block"))||void 0===s?void 0:s.getAttribute(e))&&void 0!==n&&n,r=i?E.byId[parseInt(i)].controller:void 0;return null==r?void 0:r.apiClass};s.saneKeyboardEvents=v,s.config=t=>(g.config(g.prototype,t),s),s.registerEmbed=(t,e)=>{if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";p[t]=e};for(const[e,n]of Object.entries({StaticMath:at,MathField:ct,InnerMathField:dt,TextField:ht}))t[e]=n,(s[e]=(n,i)=>{const r=s(n);if(r instanceof t[e]||!(n instanceof HTMLElement))return r;const o=new it(new t[e].RootBlock,n,new g);return o.KIND_OF_MQ=e,new t[e](o).config(i).__mathquillify()}).prototype=t[e].prototype;return s}static noConflict(){return window.MathQuill=this.origMathQuill,Tt}}Tt.origMathQuill=window.MathQuill;Tt.VERSION="0.10.1",window.MathQuill=Tt})();